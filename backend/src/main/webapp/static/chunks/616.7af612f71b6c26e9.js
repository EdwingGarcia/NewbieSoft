"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{5616:(e,t,a)=>{a.r(t),a.d(t,{default:()=>J});var s=a(5155),l=a(2115),r=a(63),i=a(1673),n=a(6651),o=a(5299),c=a(5917),d=a(9715),x=a(5229),m=a(5722),u=a(6191),h=a(508),p=a(383),b=a(368),g=a(7937),j=a(5937),f=a(6835),N=a(1786),v=a(5664),w=a(8369),y=a(5724),C=a(6109),S=a(2875);function A(e){let{onAdd:t}=e,[a,r]=(0,l.useState)(""),[i,n]=(0,l.useState)([]),[o,c]=(0,l.useState)(!1),[d,x]=(0,l.useState)("todos");return(0,l.useEffect)(()=>{(async()=>{c(!0);try{let e=await S.i.listar(a),t=e;"todos"!==d&&(t=e.filter(e=>e.tipo===d.toUpperCase())),n(t.map(e=>({id:e.id,descripcion:e.descripcion,tipo:e.tipo,costo:e.costo})))}finally{c(!1)}})()},[a,d]),(0,s.jsxs)("div",{className:"border rounded-md p-4 bg-white",children:[(0,s.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,s.jsx)("input",{className:"flex-1 border rounded px-3 py-2",placeholder:"Buscar producto o servicio",value:a,onChange:e=>r(e.target.value)}),(0,s.jsxs)("select",{className:"border rounded px-2 py-2",value:d,onChange:e=>x(e.target.value),children:[(0,s.jsx)("option",{value:"todos",children:"Todos"}),(0,s.jsx)("option",{value:"producto",children:"Producto"}),(0,s.jsx)("option",{value:"servicio",children:"Servicio"})]})]}),o&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Cargando…"}),(0,s.jsx)("ul",{className:"space-y-2 max-h-80 overflow-y-auto",style:{minHeight:i.length>0?"3.5rem":void 0},children:i.slice(0,6).map(e=>(0,s.jsxs)("li",{className:"flex justify-between items-center border rounded px-3 py-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.descripcion}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[e.tipo," — $",e.costo.toFixed(2)]})]}),(0,s.jsx)("button",{className:"px-3 py-1 bg-indigo-600 text-white rounded",onClick:()=>t(e),children:"+"})]},e.id))})]})}function E(e){let{items:t,onChangeCantidad:a,onRemove:l}=e;return(0,s.jsx)("div",{className:"border rounded-md bg-white overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-50 border-b",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Item"}),(0,s.jsx)("th",{className:"text-center px-3 py-2 w-28",children:"Cant."}),(0,s.jsx)("th",{className:"text-right px-3 py-2 w-24",children:"Unit."}),(0,s.jsx)("th",{className:"text-right px-3 py-2 w-24",children:"Total"}),(0,s.jsx)("th",{className:"text-center px-3 py-2 w-12"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>{let t="number"==typeof e.total?e.total:e.costoUnitario*e.cantidad;return(0,s.jsxs)("tr",{className:"border-b last:border-b-0",children:[(0,s.jsxs)("td",{className:"px-3 py-2",children:[(0,s.jsx)("div",{className:"font-medium",children:e.descripcion}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.tipo})]}),(0,s.jsx)("td",{className:"px-3 py-2 text-center",children:(0,s.jsx)("input",{type:"number",min:1,className:"w-20 border rounded px-2 py-1 text-center",value:e.cantidad,onChange:t=>a(e.id,Number(t.target.value))})}),(0,s.jsxs)("td",{className:"px-3 py-2 text-right",children:["$",e.costoUnitario.toFixed(2)]}),(0,s.jsxs)("td",{className:"px-3 py-2 text-right font-semibold",children:["$",t.toFixed(2)]}),(0,s.jsx)("td",{className:"px-3 py-2 text-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>l(e.id),className:"text-red-600 hover:text-red-800 text-xl font-bold",title:"Eliminar",children:"−"})})]},e.id)})})]})})}function T(e){let{items:t,ordenId:a,estado:l}=e,r=t.reduce((e,t)=>e+t.cantidad*t.costoUnitario,0),i=+(.15*r).toFixed(2),n=+(r+i).toFixed(2);return(0,s.jsxs)("div",{className:"border rounded-md p-4 bg-white space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsxs)("span",{children:["$",r.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"IVA (15%)"}),(0,s.jsxs)("span",{children:["$",i.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[(0,s.jsx)("span",{children:"Total"}),(0,s.jsxs)("span",{children:["$",n.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"pt-2 text-xs text-gray-500",children:["Orden #",a," — Estado: ",null!=l?l:"—"]})]})}var I=a(7506);function k(e){let{ordenId:t,estado:a}=e,[r,i]=(0,l.useState)([]),[n,o]=(0,l.useState)(!1),c=async()=>{o(!0);try{let e=await I.D.listarPorOrden(t);i(e)}finally{o(!1)}};(0,l.useEffect)(()=>{c()},[t]);let d=async e=>{let a=r.find(t=>t.descripcion===e.descripcion&&t.tipo===e.tipo);a?await I.D.actualizarCantidad(a.id,a.cantidad+1):await I.D.agregar(t,e.id,1),await c()},x=async(e,t)=>{t<=0||(await I.D.actualizarCantidad(e,t),await c())},m=async e=>{await I.D.eliminar(t,e),await c()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(A,{onAdd:d})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(E,{items:r,onRemove:m,onChangeCantidad:x}),(0,s.jsx)(T,{items:r,ordenId:t,estado:a}),n&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Actualizando costos…"})]})]})}var O=a(7003),R=a(3209),D=a(6170),q=a(7507),P=a(1733),z=a(7161),F=a(2933);let M="".concat(P.JR,"/api/fichas"),B="".concat(P.JR,"/api/ordenes");P.JR;let L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(B).concat(e)},G=e=>{let{value:t,onChange:a}=e,[r,d]=(0,l.useState)(!1),[x,m]=(0,l.useState)([]),[u,h]=(0,l.useState)(!1),[p,b]=(0,l.useState)(""),g=(0,l.useRef)(null),j=(0,l.useRef)(null);(0,l.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(e){h(!0);try{let t=await fetch("".concat(P.JR,"/api/equipos"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();m(Array.isArray(e)?e:[])}}catch(e){console.error("Error al cargar equipos",e)}finally{h(!1)}}})()},[]),(0,l.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let f=x.filter(e=>{let t=p.toLowerCase();return"".concat(e.marca," ").concat(e.modelo," ").concat(e.numeroSerie," ").concat(e.idEquipo).toLowerCase().includes(t)}),N=x.find(e=>e.idEquipo===Number(t));return(0,s.jsxs)("div",{className:"relative w-full",ref:g,children:[(0,s.jsxs)("div",{onClick:()=>{d(!r),r||setTimeout(()=>{var e;return null==(e=j.current)?void 0:e.focus()},100)},className:"flex h-9 w-full items-center justify-between rounded-md border bg-white px-3 py-2 text-sm shadow-sm ring-offset-background cursor-pointer hover:bg-slate-50 border-slate-300",children:[(0,s.jsx)("span",{className:"truncate text-slate-700",children:N?(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"font-semibold",children:[N.marca," ",N.modelo]}),(0,s.jsxs)("span",{className:"text-slate-400 text-xs",children:["| S/N: ",N.numeroSerie]})]}):(0,s.jsx)("span",{className:"text-slate-400 text-xs",children:"Seleccionar equipo..."})}),(0,s.jsx)(i.A,{className:"h-4 w-4 opacity-50"})]}),r&&(0,s.jsxs)("div",{className:"absolute z-50 mt-1 w-full rounded-md border border-slate-200 bg-white shadow-lg",children:[(0,s.jsxs)("div",{className:"flex items-center border-b px-3 py-2",children:[(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 opacity-50"}),(0,s.jsx)("input",{ref:j,className:"flex h-5 w-full rounded-md bg-transparent text-sm outline-none placeholder:text-slate-400",placeholder:"Buscar por serie, modelo o marca...",value:p,onChange:e=>b(e.target.value)})]}),(0,s.jsx)("div",{className:"max-h-[200px] overflow-y-auto p-1",children:u?(0,s.jsxs)("div",{className:"py-6 text-center text-sm text-slate-500 flex justify-center items-center gap-2",children:[(0,s.jsx)(o.A,{className:"h-4 w-4 animate-spin"})," Cargando..."]}):0===f.length?(0,s.jsx)("div",{className:"py-6 text-center text-sm text-slate-500",children:"No se encontraron equipos."}):f.map(e=>{var l;return(0,s.jsx)("div",{className:"relative flex cursor-default select-none items-center rounded-sm px-2 py-2 text-sm outline-none hover:bg-slate-100 cursor-pointer ".concat(Number(t)===e.idEquipo?"bg-slate-100 text-slate-900":"text-slate-700"),onClick:()=>{a(e.idEquipo),d(!1),b("")},children:(0,s.jsxs)("div",{className:"flex flex-col w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,s.jsxs)("span",{className:"font-medium",children:[e.marca," ",e.modelo]}),Number(t)===e.idEquipo&&(0,s.jsx)(c.A,{className:"h-3 w-3 text-blue-600"})]}),(0,s.jsxs)("div",{className:"text-xs text-slate-500 flex justify-between mt-0.5",children:[(0,s.jsxs)("span",{children:["S/N: ",null!=(l=e.numeroSerie)?l:"N/A"]}),(0,s.jsxs)("span",{children:["ID: ",e.idEquipo]})]})]})},e.idEquipo)})})]})]})},H=e=>1===e?"INGRESO":2===e?"EN_DIAGNOSTICO":3===e?"COSTOS":"LISTA_ENTREGA",$=e=>{let{active:t,label:a,desc:l,step:r}=e;return(0,s.jsxs)("div",{className:["group flex items-center gap-2.5 rounded-xl px-4 py-2 transition-all duration-200 select-none cursor-pointer",t?"bg-white shadow-lg shadow-white/20 scale-[1.02]":"bg-white/10 hover:bg-white/15 border border-white/20"].join(" "),children:[(0,s.jsx)("div",{className:["flex h-7 w-7 items-center justify-center rounded-lg text-xs font-bold transition-all",t?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-md":"bg-white/20 text-white/80 group-hover:bg-white/30"].join(" "),children:r}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:["block text-[11px] font-semibold leading-tight transition-colors",t?"text-slate-900":"text-white"].join(" "),children:a}),(0,s.jsx)("span",{className:["hidden sm:block text-[10px] leading-tight",t?"text-slate-500":"text-white/60"].join(" "),children:l})]})]})};function U(e){let{open:t,onClose:a,loading:r,error:i,data:n}=e;if((0,l.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,a]),!t)return null;let c=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("es-EC")}catch(t){return String(e)}},m=e=>null==e||""===e?"-":String(e),u=n?Object.entries(n).filter(e=>{let[t]=e;return!["hardwareJson"].includes(t)}).filter(e=>{let[t,a]=e;return"object"!=typeof a||null===a}).slice(0,20):[];return(0,s.jsx)("div",{className:"fixed inset-0 z-[90] flex items-center justify-center bg-black/70 backdrop-blur-sm",onMouseDown:e=>{e.target===e.currentTarget&&a()},children:(0,s.jsxs)("div",{className:"relative mx-3 w-full max-w-6xl overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 bg-slate-50 px-4 py-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 text-slate-700"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Detalle de Ficha T\xe9cnica"}),(0,s.jsxs)("p",{className:"text-[11px] text-slate-500",children:[n?"ID #".concat(n.id):"—"," •"," ",(null==n?void 0:n.fechaCreacion)?c(n.fechaCreacion):"-"]})]})]}),(0,s.jsx)("button",{onClick:a,className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-900/80 text-white hover:bg-slate-900","aria-label":"Cerrar",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,s.jsx)("div",{className:"max-h-[82vh] overflow-y-auto p-4",children:r?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[(0,s.jsx)(o.A,{className:"h-8 w-8 animate-spin text-indigo-500"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"Cargando detalles de la ficha..."})]}):i?(0,s.jsx)("div",{className:"rounded-xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700",children:i}):n?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(R.Zp,{className:"border-slate-200 shadow-sm",children:[(0,s.jsxs)(R.aR,{className:"py-3",children:[(0,s.jsx)(R.ZB,{className:"text-sm",children:"Resumen"}),(0,s.jsx)(R.BT,{className:"text-xs",children:"Informaci\xf3n general de la ficha t\xe9cnica."})]}),(0,s.jsxs)(R.Wu,{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-3 text-[12px]",children:[(0,s.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold text-slate-700",children:"Equipo"}),(0,s.jsxs)("p",{className:"mt-1 text-slate-900",children:[m(n.equipoModelo)," ",n.equipoHostname?"(".concat(n.equipoHostname,")"):""]}),(0,s.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["EquipoId: ",m(n.equipoId)]})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold text-slate-700",children:"T\xe9cnico"}),(0,s.jsx)("p",{className:"mt-1 text-slate-900",children:m(n.tecnicoNombre)}),(0,s.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["C\xe9dula: ",m(n.tecnicoCedula)]})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold text-slate-700",children:"Fecha"}),(0,s.jsx)("p",{className:"mt-1 text-slate-900",children:c(n.fechaCreacion)}),(0,s.jsxs)("p",{className:"mt-1 text-[11px] text-slate-500",children:["ID: #",n.id]})]})]}),n.observaciones&&(0,s.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold text-slate-700",children:"Observaciones"}),(0,s.jsx)("p",{className:"mt-1 whitespace-pre-wrap text-[12px] text-slate-800",children:n.observaciones})]})]})]}),u.length>0&&(0,s.jsxs)(R.Zp,{className:"border-slate-200 shadow-sm",children:[(0,s.jsxs)(R.aR,{className:"py-3",children:[(0,s.jsx)(R.ZB,{className:"text-sm",children:"Campos"}),(0,s.jsx)(R.BT,{className:"text-xs",children:"Valores principales detectados (top-level)."})]}),(0,s.jsx)(R.Wu,{children:(0,s.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:u.map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3 rounded-lg border border-slate-200 bg-slate-50 p-3",children:[(0,s.jsx)("div",{className:"text-[11px] font-semibold text-slate-700",children:t}),(0,s.jsx)("div",{className:"text-[11px] text-slate-900 text-right break-all",children:m(a)})]},t)})})})]}),void 0!==n.hardwareJson&&(0,s.jsxs)(R.Zp,{className:"border-slate-200 shadow-sm",children:[(0,s.jsxs)(R.aR,{className:"py-3",children:[(0,s.jsx)(R.ZB,{className:"text-sm",children:"Hardware JSON"}),(0,s.jsx)(R.BT,{className:"text-xs",children:"Informaci\xf3n t\xe9cnica (puede ser extensa)."})]}),(0,s.jsx)(R.Wu,{children:(0,s.jsx)("pre",{className:"max-h-[420px] overflow-auto rounded-lg border border-slate-200 bg-slate-950 p-3 text-[11px] text-slate-100",children:JSON.stringify(n.hardwareJson,null,2)})})]})]}):(0,s.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:"No hay datos para mostrar."})})]})})}function J(){var e,t;(0,r.useRouter)();let[a,i]=(0,l.useState)(!1),[S,A]=(0,l.useState)(null),[E,T]=(0,l.useState)([]),[I,B]=(0,l.useState)(!0),[J,Z]=(0,l.useState)(null),[V,_]=(0,l.useState)(null),[W,X]=(0,l.useState)([]),[Y,Q]=(0,l.useState)([]),[K,ee]=(0,l.useState)("INGRESO"),[et,ea]=(0,l.useState)(null),[es,el]=(0,l.useState)(""),[er,ei]=(0,l.useState)(1),[en,eo]=(0,l.useState)("DIAGNOSTICO"),[ec,ed]=(0,l.useState)("MEDIA"),[ex,em]=(0,l.useState)("INGRESO"),[eu,eh]=(0,l.useState)(""),[ep,eb]=(0,l.useState)(""),[eg,ej]=(0,l.useState)(0),[ef,eN]=(0,l.useState)(0),[ev,ew]=(0,l.useState)(0),[ey,eC]=(0,l.useState)(0),[eS,eA]=(0,l.useState)(0),[eE,eT]=(0,l.useState)(!1),[eI,ek]=(0,l.useState)(""),[eO,eR]=(0,l.useState)(""),[eD,eq]=(0,l.useState)(""),[eP,ez]=(0,l.useState)(""),[eF,eM]=(0,l.useState)(!1),[eB,eL]=(0,l.useState)(!1),[eG,eH]=(0,l.useState)(!1),[e$,eU]=(0,l.useState)(null),[eJ,eZ]=(0,l.useState)(!1),[eV,e_]=(0,l.useState)(1),[eW,eX]=(0,l.useState)(!1),[eY,eQ]=(0,l.useState)([]),[eK,e0]=(0,l.useState)([]),[e1,e2]=(0,l.useState)(!1),[e5,e3]=(0,l.useState)({clienteCedula:"",tecnicoCedula:"",equipoId:"",medioContacto:"",contrasenaEquipo:"",accesorios:"",problemaReportado:"",observacionesIngreso:"",tipoServicio:"DIAGNOSTICO",prioridad:"MEDIA"}),[e4,e6]=(0,l.useState)({cliente:"",tecnico:""}),[e7,e9]=(0,l.useState)(!1),[e8,te]=(0,l.useState)(""),[tt,ta]=(0,l.useState)(null),[ts,tl]=(0,l.useState)(null),[tr,ti]=(0,l.useState)(!1),[tn,to]=(0,l.useState)(!1),[tc,td]=(0,l.useState)(null),[tx,tm]=(0,l.useState)(null),[tu,th]=(0,l.useState)(null),[tp,tb]=(0,l.useState)([]),[tg,tj]=(0,l.useState)(!1),[tf,tN]=(0,l.useState)(null),[tv,tw]=(0,l.useState)(!1),[ty,tC]=(0,l.useState)(null),[tS,tA]=(0,l.useState)(!1),[tE,tT]=(0,l.useState)(!1),[tI,tk]=(0,l.useState)("conformidad"),[tO,tR]=(0,l.useState)(null),[tD,tq]=(0,l.useState)(!1),[tP,tz]=(0,l.useState)(!1),[tF,tM]=(0,l.useState)(!1),[tB,tL]=(0,l.useState)(null),[tG,tH]=(0,l.useState)(null),[t$,tU]=(0,l.useState)(!1),[tJ,tZ]=(0,l.useState)(!1),[tV,t_]=(0,l.useState)(null),[tW,tX]=(0,l.useState)(!1),[tY,tQ]=(0,l.useState)("cliente"),[tK,t0]=(0,l.useState)(""),[t1,t2]=(0,l.useState)(""),[t5,t3]=(0,l.useState)(""),[t4,t6]=(0,l.useState)(""),[t7,t9]=(0,l.useState)(""),[t8,ae]=(0,l.useState)(""),[at,aa]=(0,l.useState)("desc"),as=localStorage.getItem("token"),al=e=>null==e||""===e?"-":String(e),ar=e=>e?new Date(e).toLocaleString():"-",ai=(0,l.useMemo)(()=>eg+ef+ev-ey,[eg,ef,ev,ey]),an=(0,l.useMemo)(()=>ai+eS,[ai,eS]),ao=e=>e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):"",ac=(0,l.useMemo)(()=>{let e=ao(t4);return E.filter(t=>{let a=!e||ao(t.numeroOrden).includes(e)||ao(t.equipoModelo).includes(e)||ao(t.equipoHostname).includes(e)||ao(t.clienteNombre).includes(e)||ao(t.clienteCedula).includes(e)||ao(t.tecnicoNombre).includes(e)||ao(t.tecnicoCedula).includes(e)||ao(t.problemaReportado).includes(e),s=!0;if(t7||t8){let e=new Date(t.fechaHoraIngreso),a=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i="".concat(a,"-").concat(l,"-").concat(r);t7&&i<t7&&(s=!1),t8&&i>t8&&(s=!1)}return a&&s}).sort((e,t)=>{let a=new Date(e.fechaHoraIngreso).getTime(),s=new Date(t.fechaHoraIngreso).getTime();return"asc"===at?a-s:s-a})},[E,t4,t7,t8,at]);(0,l.useEffect)(()=>{e_(1)},[t4,t7,t8]);let ad=(0,F.Zz)()||6,ax=Math.ceil(ac.length/ad),am=(eV-1)*ad,au=ac.slice(am,am+ad),ah=(null==V||null==(e=V.estado)?void 0:e.toUpperCase())==="CERRADA",ap=(0,l.useCallback)(async()=>{B(!0),Z(null);try{let e=await fetch(L("/mis-ordenes"),{headers:{Authorization:"Bearer ".concat(as)}});if(!e.ok)throw Error("Error al cargar \xf3rdenes de trabajo (HTTP ".concat(e.status,")"));let t=await e.json();T(t)}catch(t){var e;Z(null!=(e=t.message)?e:"Error al cargar \xf3rdenes de trabajo")}finally{B(!1)}},[as]),ab=(0,l.useCallback)(async()=>{if(as)try{let e=await fetch("".concat(P.JR,"/api/usuarios"),{headers:{Authorization:"Bearer ".concat(as)}}),t=await e.json();eQ(t.filter(e=>{var t;return(null==(t=e.rol)?void 0:t.nombre)==="ROLE_CLIENTE"})),e0(t.filter(e=>{var t;return(null==(t=e.rol)?void 0:t.nombre)==="ROLE_TECNICO"}))}catch(e){console.error("Error cargando combos:",e)}},[as]);(0,l.useEffect)(()=>{ap(),ab()},[ap,ab]);let ag=async e=>{if(e3(t=>({...t,equipoId:String(e)})),as)try{let l=await fetch("".concat(P.JR,"/api/equipos/").concat(e),{headers:{Authorization:"Bearer ".concat(as)}});if(l.ok){var t,a,s;let e=await l.json(),r=(null==(t=e.cliente)?void 0:t.cedula)||e.cedulaCliente||"",i=(null==(a=e.tecnico)?void 0:a.cedula)||e.tecnicoCedula||"",n=(null==(s=e.tecnico)?void 0:s.nombre)||e.tecnicoNombre||"",o="";if(r)try{let e=await fetch("".concat(P.JR,"/api/usuarios/").concat(r),{headers:{Authorization:"Bearer ".concat(as)}});e.ok&&(o=(await e.json()).nombre||"")}catch(e){console.error("Error buscando nombre de cliente:",e)}e3(e=>({...e,clienteCedula:r,tecnicoCedula:i})),e6({cliente:o,tecnico:n})}}catch(e){console.error("Error al obtener datos del equipo:",e)}},aj=(0,l.useCallback)(async e=>{try{let t=await fetch(L("/".concat(e,"/imagenes")),{headers:{Authorization:"Bearer ".concat(as)}});if(204===t.status)return void X([]);if(!t.ok)throw Error("Error al cargar im\xe1genes (HTTP ".concat(t.status,")"));let a=await t.json();X(a)}catch(e){console.error(e),X([])}},[as]),af=(0,l.useCallback)(()=>{_(null),X([]),ea(null),el("")},[]);(0,l.useEffect)(()=>{if(!V)return;let e=e=>{"Escape"===e.key&&af()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[V,af]);let aN=async e=>{try{Z(null);let t=await fetch(L("/".concat(e,"/detalle")),{headers:{Authorization:"Bearer ".concat(as)}});if(!t.ok)throw Error("Error al cargar detalles (HTTP ".concat(t.status,")"));let a=await t.json();_(a),Q([]),ea(null),el(""),aC(a.numeroOrden),(e=>{var t,a,s,l,r,i,n,o,c,d,x,m,u;eo(null!=(t=e.tipoServicio)?t:"DIAGNOSTICO"),ed(null!=(a=e.prioridad)?a:"MEDIA");let h=(e=>{let t=(e||"").toUpperCase();return"INGRESO"===t||"PENDIENTE"===t?1:"EN_DIAGNOSTICO"===t?2:"COSTOS"===t?3:"LISTA_ENTREGA"===t||"CERRADO"===t?4:1})(null!=(s=e.estado)?s:"INGRESO");ei(h),em(H(h)),eh(null!=(l=e.diagnosticoTrabajo)?l:""),eb(null!=(r=e.observacionesRecomendaciones)?r:""),ej(null!=(i=e.costoManoObra)?i:0),eN(null!=(n=e.costoRepuestos)?n:0),ew(null!=(o=e.costoOtros)?o:0),eC(null!=(c=e.descuento)?c:0),eA(null!=(d=e.iva)?d:0),eT(!!e.esEnGarantia),ek(null!=e.referenciaOrdenGarantia?String(e.referenciaOrdenGarantia):""),eR(null!=(x=e.motivoCierre)?x:""),eq(null!=(m=e.cerradaPor)?m:""),ez(null!=(u=e.otpCodigo)?u:""),eM(!!e.otpValidado),eU(null),eL(!1),eH(!1)})(a),await aj(e),await aB(e,a.equipoId)}catch(e){var t;Z(null!=(t=e.message)?t:"Error al cargar detalles de la orden")}},av=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!V)return;if(!as)return void alert("No hay token de autenticaci\xf3n");let t=H(er),a={tipoServicio:en,prioridad:ec,estado:e?"CERRADO":t,diagnosticoTrabajo:eu.trim(),observacionesRecomendaciones:ep.trim(),costoManoObra:eg,costoRepuestos:ef,costoOtros:ev,descuento:ey,subtotal:ai,iva:eS,total:an,esEnGarantia:eE,referenciaOrdenGarantia:eI?Number(eI):null,motivoCierre:eO.trim()||null,cerradaPor:eD.trim()||null,otpCodigo:eP.trim()||null,otpValidado:eF,cerrarOrden:e};try{eZ(!0);let t=await fetch(L("/".concat(V.ordenId,"/entrega")),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(as)},body:JSON.stringify(a)});if(!t.ok)throw Error("Error guardando (HTTP ".concat(t.status,")"));alert(e?"✅ Orden cerrada correctamente":"✅ Cambios guardados"),await aN(V.ordenId),await ap()}catch(e){var s;console.error(e),alert(null!=(s=null==e?void 0:e.message)?s:"Error guardando datos de la orden")}finally{eZ(!1)}},aw=async()=>{if(V){if(4!==er){alert("Solo puedes cerrar la orden en el Paso 4. Se guardar\xe1 como borrador."),await av(!1);return}if(!eu.trim())return void alert("Debes registrar un diagn\xf3stico antes de cerrar la orden.");if(!tP)return void alert("El cliente debe firmar la conformidad del procedimiento antes de poder cerrar la orden.");if(!tF)return void alert("El cliente debe firmar el recibo de entrega antes de poder cerrar la orden.");await av(!0)}},ay=async()=>{if(V){if(0===Y.length)return void alert("Selecciona al menos una imagen");try{let e=new FormData;Y.forEach(t=>e.append("files",t)),e.append("categoria",K);let t=await fetch(L("/".concat(V.ordenId,"/imagenes")),{method:"POST",headers:{Authorization:"Bearer ".concat(as)},body:e});if(!t.ok)throw Error("Error ".concat(t.status," subiendo im\xe1genes"));alert("\uD83D\uDCF8 Im\xe1genes subidas correctamente"),Q([]),await aj(V.ordenId)}catch(t){var e;alert("❌ "+(null!=(e=t.message)?e:"Error subiendo im\xe1genes"))}}},aC=async e=>{if(!e||!as){tz(!1),tM(!1),tL(null),tH(null);return}try{let t=await fetch("".concat(P.JR,"/api/firmas/estado/").concat(e),{headers:{Authorization:"Bearer ".concat(as)}});if(t.ok){let e=await t.json();tz(e.conformidadFirmada||!1),tM(e.reciboFirmado||!1),tL(e.conformidadFecha||null),tH(e.reciboFecha||null)}else tz(!1),tM(!1),tL(null),tH(null)}catch(e){tz(!1),tM(!1),tL(null),tH(null)}},aS=async(e,t)=>{if(!as)return void alert("Tu sesi\xf3n ha expirado. Por favor inicia sesi\xf3n nuevamente.");try{let a="".concat(P.JR,"/api/documentos/").concat(e,"/documentos/").concat(t),s=await fetch(a,{headers:{Authorization:"Bearer ".concat(as)}});if(!s.ok)return void(401===s.status?alert("Tu sesi\xf3n ha expirado. Por favor inicia sesi\xf3n nuevamente."):404===s.status?alert("El documento no fue encontrado."):alert("Error al cargar el documento (HTTP ".concat(s.status,")")));let l=await s.blob(),r=URL.createObjectURL(l);window.open(r,"_blank"),setTimeout(()=>URL.revokeObjectURL(r),6e4)}catch(e){console.error("Error al abrir documento:",e),alert("Error al cargar el documento")}},aA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"conformidad";tk(e),tT(!0),tq(!1),setTimeout(()=>{if(tO){let e=tO.getContext("2d");e&&(e.lineWidth=2,e.lineCap="round",e.lineJoin="round",e.strokeStyle="#000")}},0)},aE=()=>{if(tO){let e=tO.getContext("2d");e&&e.clearRect(0,0,tO.width,tO.height)}},aT=async()=>{if(!V||!tO)return;let e=localStorage.getItem("token");if(!e)return void alert("Tu sesi\xf3n ha expirado. Por favor inicia sesi\xf3n nuevamente.");let t=tO.toDataURL("image/png"),a=[null==V?void 0:V.marca,(null==V?void 0:V.modelo)||(null==V?void 0:V.equipoModelo)].filter(Boolean).join(" "),s={ordenId:Number(null==V?void 0:V.ordenId)||0,numeroOrden:String((null==V?void 0:V.numeroOrden)||""),cliente:String((null==V?void 0:V.clienteNombre)||""),clienteCedula:String((null==V?void 0:V.clienteCedula)||""),clienteTelefono:String((null==V?void 0:V.clienteTelefono)||""),clienteCorreo:String((null==V?void 0:V.clienteCorreo)||""),equipo:a||String((null==V?void 0:V.equipoModelo)||""),equipoNumeroSerie:String((null==V?void 0:V.numeroSerie)||""),equipoTipo:String((null==V?void 0:V.tipoEquipo)||""),tecnicoNombre:String((null==V?void 0:V.tecnicoNombre)||""),tecnicoCedula:String((null==V?void 0:V.tecnicoCedula)||""),procedimiento:String(eu||""),modo:String(tI||""),firma:t};try{let t=await fetch("".concat(P.JR,"/api/firmas/conformidad"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(s)});if(!t.ok)throw Error("Error al guardar firma (HTTP ".concat(t.status,")"));alert("✅ Firma guardada correctamente"),tT(!1),aE(),"conformidad"===tI?tz(!0):tM(!0)}catch(e){var l;console.error(e),alert("❌ "+(null!=(l=null==e?void 0:e.message)?l:"Error al guardar firma"))}},aI=e=>{if(!tO)return;let t=tO.getContext("2d");if(!t)return;tq(!0);let a=tO.getBoundingClientRect(),s="touches"in e?e.touches[0].clientX:e.clientX,l="touches"in e?e.touches[0].clientY:e.clientY;t.beginPath(),t.moveTo(s-a.left,l-a.top)},ak=e=>{if(!tD||!tO)return;let t=tO.getContext("2d");if(!t)return;let a=tO.getBoundingClientRect(),s="touches"in e?e.touches[0].clientX:e.clientX,l="touches"in e?e.touches[0].clientY:e.clientY;t.lineTo(s-a.left,l-a.top),t.stroke()},aO=()=>tq(!1),aR=()=>{tQ("cliente"),t0(""),t2(""),t3(""),tZ(!0),tX(!1),setTimeout(()=>{if(tV){let e=tV.getContext("2d");e&&(e.lineWidth=2,e.lineCap="round",e.lineJoin="round",e.strokeStyle="#000")}},0)},aD=()=>{if(tV){let e=tV.getContext("2d");e&&e.clearRect(0,0,tV.width,tV.height)}},aq=async()=>{if(!V||!tV)return;if("tercero"===tY){if(!tK.trim())return void alert("Ingresa el nombre de quien recibe");if(!t1.trim())return void alert("Ingresa la c\xe9dula de quien recibe")}let e=localStorage.getItem("token");if(!e)return void alert("Tu sesi\xf3n ha expirado. Por favor inicia sesi\xf3n nuevamente.");let t=tV.toDataURL("image/png"),a=[null==V?void 0:V.marca,(null==V?void 0:V.modelo)||(null==V?void 0:V.equipoModelo)].filter(Boolean).join(" "),s={ordenId:Number(null==V?void 0:V.ordenId)||0,numeroOrden:String((null==V?void 0:V.numeroOrden)||""),cliente:String((null==V?void 0:V.clienteNombre)||""),clienteCedula:String((null==V?void 0:V.clienteCedula)||""),clienteTelefono:String((null==V?void 0:V.clienteTelefono)||""),clienteCorreo:String((null==V?void 0:V.clienteCorreo)||""),equipo:a||String((null==V?void 0:V.equipoModelo)||""),equipoNumeroSerie:String((null==V?void 0:V.numeroSerie)||""),equipoTipo:String((null==V?void 0:V.tipoEquipo)||""),tecnicoNombre:String((null==V?void 0:V.tecnicoNombre)||""),tecnicoCedula:String((null==V?void 0:V.tecnicoCedula)||""),procedimiento:String(eu||""),modo:"recibo",firma:t,tipoFirmante:tY,firmante:"cliente"===tY?{nombre:null==V?void 0:V.clienteNombre,cedula:null==V?void 0:V.clienteCedula,relacion:"Cliente"}:{nombre:tK,cedula:t1,relacion:t5||"Representante"}};try{let t=await fetch("".concat(P.JR,"/api/firmas/conformidad"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(s)});if(!t.ok)throw Error("Error al guardar firma (HTTP ".concat(t.status,")"));alert("✅ Firma de recibo guardada correctamente"),tZ(!1),aD(),tM(!0)}catch(e){var l;console.error(e),alert("❌ "+(null!=(l=null==e?void 0:e.message)?l:"Error al guardar firma"))}},aP=e=>{if(!tV)return;let t=tV.getContext("2d");if(!t)return;tX(!0);let a=tV.getBoundingClientRect(),s="touches"in e?e.touches[0].clientX:e.clientX,l="touches"in e?e.touches[0].clientY:e.clientY;t.beginPath(),t.moveTo(s-a.left,l-a.top)},az=e=>{if(!tW||!tV)return;let t=tV.getContext("2d");if(!t)return;let a=tV.getBoundingClientRect(),s="touches"in e?e.touches[0].clientX:e.clientX,l="touches"in e?e.touches[0].clientY:e.clientY;t.lineTo(s-a.left,l-a.top),t.stroke()},aF=()=>tX(!1),aM=()=>{ti(!1),to(!1),td(null),tm(null),th(null)},aB=(0,l.useCallback)(async(e,t)=>{if(as){var a;tj(!0),tN(null);try{let t=await fetch("".concat(M,"/orden-trabajo/").concat(e),{headers:{Authorization:"Bearer ".concat(as)}});if(204===t.status||404===t.status)return void tb([]);if(!t.ok)throw Error("Error al cargar fichas (HTTP ".concat(t.status,")"));let a=await t.json();if(!Array.isArray(a)||0===a.length)return void tb([]);let s=(!a?[]:(Array.isArray(a)?a:(null==a?void 0:a.data)&&Array.isArray(a.data)?a.data:[a]).filter(Boolean).map(e=>{var t,a,s,l,r;return{id:Number(e.id),fechaCreacion:null!=(a=null!=(t=e.fechaCreacion)?t:e.createdAt)?a:new Date().toISOString(),tecnicoNombre:null!=(l=null!=(s=e.tecnicoNombre)?s:e.tecnicoId)?l:null,observaciones:null!=(r=e.observaciones)?r:null}}).filter(e=>Number.isFinite(e.id))).slice().sort((e,t)=>new Date(t.fechaCreacion).getTime()-new Date(e.fechaCreacion).getTime());tb(s)}catch(e){console.error("Error en fetchFichasAnexasPorOT:",e),tb([]),tN(null!=(a=null==e?void 0:e.message)?a:"Error cargando fichas anexas")}finally{tj(!1)}}},[as]),aL=e=>{tC(e),tw(!0)},aG=e=>{let{name:t,value:a}=e.target;e3(e=>({...e,[t]:a}))},aH=()=>{e3({clienteCedula:"",tecnicoCedula:"",equipoId:"",medioContacto:"",contrasenaEquipo:"",accesorios:"",problemaReportado:"",observacionesIngreso:"",tipoServicio:"DIAGNOSTICO",prioridad:"MEDIA"}),e6({cliente:"",tecnico:""})},a$=async e=>{if(window.confirm("\xbfEst\xe1s seguro de que deseas eliminar esta ficha t\xe9cnica? Esta acci\xf3n no se puede deshacer.")){if(!as)return void alert("No hay token de autenticaci\xf3n");try{let t=await fetch("".concat(M,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(as)}});if(!t.ok)throw Error("Error eliminando ficha (HTTP ".concat(t.status,")"));alert("✅ Ficha t\xe9cnica eliminada correctamente"),V&&await aB(V.ordenId,V.equipoId),tr&&aM()}catch(e){var t;console.error("Error al eliminar ficha:",e),alert("❌ "+(null!=(t=null==e?void 0:e.message)?t:"Error eliminando la ficha t\xe9cnica"))}}},aU=async()=>{if(!as)return void alert("No hay token de autenticaci\xf3n");if(!e5.clienteCedula.trim())return void alert("La c\xe9dula del cliente es obligatoria");if(!e5.equipoId.trim()||isNaN(Number(e5.equipoId)))return void alert("El ID de equipo debe ser un n\xfamero v\xe1lido");if(!e5.problemaReportado.trim())return void alert("El problema reportado es obligatorio");if(!e5.tipoServicio)return void alert("El tipo de servicio es obligatorio");if(!e5.prioridad)return void alert("La prioridad es obligatoria");let e={clienteCedula:e5.clienteCedula.trim(),tecnicoCedula:e5.tecnicoCedula.trim(),equipoId:Number(e5.equipoId),medioContacto:e5.medioContacto.trim(),contrasenaEquipo:e5.contrasenaEquipo.trim(),accesorios:e5.accesorios.trim(),problemaReportado:e5.problemaReportado.trim(),observacionesIngreso:e5.observacionesIngreso.trim(),tipoServicio:e5.tipoServicio,prioridad:e5.prioridad};try{e2(!0);let t=await fetch(L(""),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(as)},body:JSON.stringify(e)});if(!t.ok)throw Error("Error creando OT (HTTP ".concat(t.status,")"));alert("✅ Orden de trabajo creada correctamente"),aH(),eX(!1),await ap()}catch(e){var t;console.error(e),alert(null!=(t=null==e?void 0:e.message)?t:"Error creando la orden de trabajo")}finally{e2(!1)}};return(0,s.jsx)("div",{className:"min-h-full h-full bg-gradient-to-br from-slate-50 to-purple-50/30 px-4 py-6 lg:px-8",children:(0,s.jsxs)("div",{className:"h-full space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 rounded-xl border border-purple-100 bg-white px-5 py-4 shadow-sm md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-gradient-to-br from-purple-600 to-indigo-700 shadow-lg shadow-purple-500/30 flex-shrink-0",children:(0,s.jsx)(d.A,{className:"h-6 w-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-slate-800",children:"\xd3rdenes de Trabajo"}),(0,s.jsxs)("p",{className:"text-sm text-purple-600 font-medium",children:[E.length," \xf3rdenes registradas"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center",children:[(0,s.jsxs)("div",{className:"relative min-w-[220px]",children:[(0,s.jsx)(n.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-purple-400"}),(0,s.jsx)(D.p,{placeholder:"Buscar OT, cliente, equipo...",className:"h-9 w-full pl-9 text-sm bg-purple-50/50 border-purple-200 focus-visible:ring-purple-400",value:t4,onChange:e=>t6(e.target.value)}),t4&&(0,s.jsx)("button",{onClick:()=>t6(""),className:"absolute right-2 top-2.5 text-purple-400 hover:text-purple-600",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,s.jsxs)("div",{className:"relative flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-purple-600 font-medium",children:"Desde:"}),(0,s.jsx)(D.p,{type:"date",className:"h-9 w-36 text-sm bg-purple-50/50 border-purple-200",value:t7,onChange:e=>t9(e.target.value)})]}),(0,s.jsxs)("div",{className:"relative flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-purple-600 font-medium",children:"Hasta:"}),(0,s.jsx)(D.p,{type:"date",className:"h-9 w-36 text-sm bg-purple-50/50 border-purple-200",value:t8,onChange:e=>ae(e.target.value)})]})]}),(0,s.jsx)("div",{className:"relative min-w-[140px]",children:(0,s.jsxs)(q.l6,{value:at,onValueChange:e=>aa(e),children:[(0,s.jsx)(q.bq,{className:"h-9 w-full bg-purple-50/50 border-purple-200 text-xs",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-purple-600",children:[(0,s.jsx)(m.A,{className:"h-3.5 w-3.5"}),(0,s.jsx)(q.yv,{placeholder:"Orden"})]})}),(0,s.jsxs)(q.gC,{children:[(0,s.jsx)(q.eb,{value:"desc",children:"M\xe1s recientes"}),(0,s.jsx)(q.eb,{value:"asc",children:"M\xe1s antiguas"})]})]})}),(0,s.jsxs)(O.$,{size:"sm",className:"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white shadow-md shadow-purple-500/25 whitespace-nowrap",onClick:()=>eX(e=>!e),children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),eW?"Cerrar form":"Nueva OT"]})]})]}),eW&&(0,s.jsxs)(R.Zp,{className:"border border-slate-200 bg-white shadow-sm",children:[(0,s.jsxs)(R.aR,{className:"border-b border-slate-100 pb-3",children:[(0,s.jsx)(R.ZB,{className:"text-base font-semibold text-slate-900",children:"Crear nueva Orden de Trabajo"}),(0,s.jsx)(R.BT,{className:"text-xs text-slate-500",children:"Selecciona el equipo para cargar autom\xe1ticamente los responsables."})]}),(0,s.jsxs)(R.Wu,{className:"space-y-4 pt-4",children:[(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-1",children:(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Equipo *"}),(0,s.jsx)(G,{value:e5.equipoId,onChange:ag}),(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:"Busca por serie, marca o modelo. Esto asignar\xe1 el cliente y t\xe9cnico autom\xe1ticamente."})]})}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Cliente (Asignado al equipo)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(D.p,{readOnly:!0,disabled:!0,value:e5.clienteCedula?"".concat(e4.cliente||"Cargando..."," (").concat(e5.clienteCedula,")"):"",placeholder:"Se cargar\xe1 autom\xe1ticamente...",className:"h-9 bg-slate-100 text-slate-600 font-medium"}),(0,s.jsx)("input",{type:"hidden",name:"clienteCedula",value:e5.clienteCedula}),(0,s.jsx)(h.A,{className:"absolute right-3 top-2.5 h-4 w-4 text-slate-400"})]})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"T\xe9cnico (Responsable del equipo)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(D.p,{readOnly:!0,disabled:!0,value:e5.tecnicoCedula?"".concat(e4.tecnico||"Sin nombre"," (").concat(e5.tecnicoCedula,")"):"",placeholder:"Se cargar\xe1 autom\xe1ticamente...",className:"h-9 bg-slate-100 text-slate-600 font-medium"}),(0,s.jsx)("input",{type:"hidden",name:"tecnicoCedula",value:e5.tecnicoCedula}),(0,s.jsx)(h.A,{className:"absolute right-3 top-2.5 h-4 w-4 text-slate-400"})]})]})]}),(0,s.jsx)("div",{className:"border-t border-slate-100 my-2"}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Medio de contacto"}),(0,s.jsx)(D.p,{name:"medioContacto",value:e5.medioContacto,onChange:aG,placeholder:"WhatsApp, llamada, correo...",className:"h-9 text-sm"})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Tipo de servicio *"}),(0,s.jsxs)(q.l6,{value:e5.tipoServicio,onValueChange:e=>e3(t=>({...t,tipoServicio:e})),children:[(0,s.jsx)(q.bq,{className:"h-9 text-xs",children:(0,s.jsx)(q.yv,{placeholder:"Selecciona tipo"})}),(0,s.jsxs)(q.gC,{children:[(0,s.jsx)(q.eb,{value:"DIAGNOSTICO",children:"DIAGNOSTICO"}),(0,s.jsx)(q.eb,{value:"REPARACION",children:"REPARACION"}),(0,s.jsx)(q.eb,{value:"MANTENIMIENTO",children:"MANTENIMIENTO"}),(0,s.jsx)(q.eb,{value:"FORMATEO",children:"FORMATEO"}),(0,s.jsx)(q.eb,{value:"INSTALACION_SO",children:"INSTALACION_SO"}),(0,s.jsx)(q.eb,{value:"OTRO",children:"OTRO"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Prioridad *"}),(0,s.jsxs)(q.l6,{value:e5.prioridad,onValueChange:e=>e3(t=>({...t,prioridad:e})),children:[(0,s.jsx)(q.bq,{className:"h-9 text-xs",children:(0,s.jsx)(q.yv,{placeholder:"Selecciona prioridad"})}),(0,s.jsxs)(q.gC,{children:[(0,s.jsx)(q.eb,{value:"BAJA",children:"Baja"}),(0,s.jsx)(q.eb,{value:"MEDIA",children:"Media"}),(0,s.jsx)(q.eb,{value:"ALTA",children:"Alta"}),(0,s.jsx)(q.eb,{value:"URGENTE",children:"Urgente"})]})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Contrase\xf1a equipo"}),(0,s.jsx)(D.p,{name:"contrasenaEquipo",value:e5.contrasenaEquipo,onChange:aG,placeholder:"***",className:"h-9 text-sm"})]}),(0,s.jsxs)("div",{className:"md:col-span-2 space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Accesorios"}),(0,s.jsx)(D.p,{name:"accesorios",value:e5.accesorios,onChange:aG,placeholder:"Cargador, mouse, base, etc.",className:"h-9 text-sm"})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Problema reportado *"}),(0,s.jsx)("textarea",{name:"problemaReportado",value:e5.problemaReportado,onChange:aG,placeholder:"Descripci\xf3n del problema...",className:"w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",rows:3})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-slate-700",children:"Observaciones de ingreso"}),(0,s.jsx)("textarea",{name:"observacionesIngreso",value:e5.observacionesIngreso,onChange:aG,placeholder:"Rayones, estado f\xedsico, notas adicionales...",className:"w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",rows:3})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,s.jsx)(O.$,{variant:"outline",size:"sm",className:"border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{aH(),eX(!1)},children:"Cancelar"}),(0,s.jsxs)(O.$,{size:"sm",onClick:aU,disabled:e1,className:"flex items-center gap-2 bg-slate-900 text-slate-50 hover:bg-slate-800",children:[e1&&(0,s.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Guardar OT"]})]})]})]}),J&&(0,s.jsx)("div",{className:"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:J}),I?(0,s.jsx)("div",{className:"flex justify-center py-10",children:(0,s.jsx)(o.A,{className:"h-6 w-6 animate-spin text-indigo-500"})}):0===ac.length?(0,s.jsxs)("div",{className:"rounded-xl border border-dashed border-slate-300 bg-slate-100/50 px-4 py-12 text-center",children:[(0,s.jsx)(n.A,{className:"mx-auto h-8 w-8 text-slate-400 mb-2"}),(0,s.jsx)("p",{className:"text-sm font-medium text-slate-800",children:"No se encontraron \xf3rdenes"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:t4||t7||t8?"No hay resultados para tus filtros.":"No hay \xf3rdenes registradas en el sistema."}),(t4||t7||t8)&&(0,s.jsx)(O.$,{variant:"link",className:"mt-2 h-auto p-0 text-xs text-indigo-600 hover:text-indigo-700",onClick:()=>{t6(""),t9(""),ae("")},children:"Limpiar filtros"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:au.map(e=>(0,s.jsxs)(R.Zp,{onDoubleClick:()=>aN(e.id),className:"cursor-pointer border border-slate-200 bg-white shadow-sm transition-all hover:shadow-lg hover:shadow-indigo-500/10 hover:border-indigo-300 hover:-translate-y-0.5",children:[(0,s.jsxs)(R.aR,{className:"pb-3",children:[(0,s.jsxs)(R.ZB,{className:"flex items-start justify-between gap-2 text-sm",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("span",{className:"block font-bold text-slate-800",children:e.numeroOrden}),(0,s.jsxs)("span",{className:"text-[11px] text-slate-500",children:[al(e.equipoModelo)," ",e.equipoHostname?"(".concat(e.equipoHostname,")"):""]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[e.estado&&(0,s.jsx)("span",{className:"rounded-full px-2.5 py-1 text-[10px] font-semibold uppercase ".concat((e=>{let t=(e||"").toUpperCase();return"EN_DIAGNOSTICO"===t||"COSTOS"===t?"bg-indigo-50 text-indigo-700 border border-indigo-200":"INGRESO"===t||"PENDIENTE"===t?"bg-purple-50 text-purple-700 border border-purple-200":"CERRADO"===t||"LISTA_ENTREGA"===t?"bg-emerald-50 text-emerald-700 border border-emerald-200":"bg-slate-50 text-slate-700 border border-slate-200"})(e.estado)),children:e.estado}),(0,s.jsxs)("div",{className:"flex gap-1",children:[e.tipoServicio&&(0,s.jsx)("span",{className:"rounded-full bg-indigo-50 px-2 py-[2px] text-[10px] uppercase text-indigo-600 font-medium",children:e.tipoServicio}),e.prioridad&&(0,s.jsx)("span",{className:"rounded-full bg-purple-50 px-2 py-[2px] text-[10px] uppercase text-purple-600 font-medium",children:e.prioridad})]})]})]}),(0,s.jsx)(R.BT,{children:(0,s.jsxs)("div",{className:"mt-2 flex flex-col gap-1.5 text-xs text-slate-600",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(h.A,{className:"h-3 w-3 text-indigo-400"}),(0,s.jsx)("span",{className:"font-medium text-slate-700",children:"Cliente:"}),al(e.clienteNombre)]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(h.A,{className:"h-3 w-3 text-purple-400"}),(0,s.jsx)("span",{className:"font-medium text-slate-700",children:"T\xe9cnico:"}),al(e.tecnicoNombre)||al(e.tecnicoCedula)]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-1.5 text-[11px] text-slate-500",children:[(0,s.jsx)(p.A,{className:"h-3 w-3"}),ar(e.fechaHoraIngreso)]})]})})]}),(0,s.jsxs)(R.Wu,{className:"space-y-3 pt-0",children:[(0,s.jsxs)("div",{className:"text-xs text-slate-600 line-clamp-2 bg-slate-50 rounded-lg p-2 border border-slate-100",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-700",children:"Problema: "}),al(e.problemaReportado)]}),(0,s.jsx)("div",{className:"flex items-center justify-center pt-1",children:(0,s.jsx)("span",{className:"text-[10px] text-slate-400 italic",children:"Doble clic para ver detalle"})})]})]},e.id))}),(0,s.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4 px-2",children:[(0,s.jsx)("span",{className:"text-xs text-slate-500 italic",children:"Doble clic en una tarjeta para ver detalles"}),ac.length>ad&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-sm text-slate-600",children:[am+1," - ",Math.min(am+ad,ac.length)," de ",ac.length]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(O.$,{variant:"outline",size:"icon",className:"h-8 w-8 border-indigo-200 hover:bg-indigo-50 hover:border-indigo-300",onClick:()=>e_(e=>Math.max(1,e-1)),disabled:1===eV,children:(0,s.jsx)(b.A,{className:"h-4 w-4"})}),(0,s.jsxs)("span",{className:"px-3 text-sm text-indigo-600 font-medium min-w-[60px] text-center",children:[eV," / ",ax]}),(0,s.jsx)(O.$,{variant:"outline",size:"icon",className:"h-8 w-8 border-indigo-200 hover:bg-indigo-50 hover:border-indigo-300",onClick:()=>e_(e=>Math.min(ax,e+1)),disabled:eV===ax,children:(0,s.jsx)(g.A,{className:"h-4 w-4"})})]})]})]})]}),V&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-slate-900/80 via-slate-800/70 to-slate-900/80 backdrop-blur-md",onMouseDown:e=>{e.target===e.currentTarget&&af()},children:(0,s.jsxs)("div",{className:"relative mx-3 flex h-[94vh] w-full max-w-7xl flex-col overflow-hidden rounded-3xl border border-white/10 bg-white shadow-2xl shadow-black/30",children:[(0,s.jsxs)("header",{className:"sticky top-0 z-20 bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 px-6 py-5",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSA2MCAwIEwgMCAwIDAgNjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjAzKSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')] opacity-50"}),(0,s.jsxs)("div",{className:"relative flex flex-wrap items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2 pr-10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 shadow-lg shadow-indigo-500/30",children:(0,s.jsx)(d.A,{className:"h-5 w-5 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-lg font-bold leading-tight text-white",children:["Orden #",V.numeroOrden]}),(0,s.jsx)("p",{className:"text-[12px] text-indigo-200",children:null!=(t=V.equipoModelo)?t:"Equipo #".concat(V.equipoId)})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-[11px]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(h.A,{className:"h-3.5 w-3.5 text-slate-400"}),(0,s.jsx)("span",{className:"text-slate-300",children:"Cliente:"}),(0,s.jsx)("span",{className:"font-medium text-white",children:al(V.clienteNombre)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(h.A,{className:"h-3.5 w-3.5 text-slate-400"}),(0,s.jsx)("span",{className:"text-slate-300",children:"T\xe9cnico:"}),(0,s.jsx)("span",{className:"font-medium text-white",children:al(V.tecnicoNombre)||al(V.tecnicoCedula)})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 text-[10px]",children:[(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-lg bg-white/10 px-2.5 py-1 text-slate-200",children:[(0,s.jsx)(p.A,{className:"h-3 w-3"}),"Ingreso: ",ar(V.fechaHoraIngreso)]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-lg bg-white/10 px-2.5 py-1 text-slate-200",children:[(0,s.jsx)(p.A,{className:"h-3 w-3"}),"Entrega: ",ar(V.fechaHoraEntrega)]}),V.medioContacto&&(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-lg bg-white/10 px-2.5 py-1 text-slate-200",children:[(0,s.jsx)(j.A,{className:"h-3 w-3"}),V.medioContacto]})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[eE&&(0,s.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-purple-500/30 to-indigo-500/30 px-3 py-1.5 text-[11px] font-semibold text-purple-100 shadow-inner",children:[(0,s.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-purple-400"}),"Garant\xeda"]}),(0,s.jsxs)(O.$,{variant:"ghost",size:"sm",onClick:()=>tU(!0),className:"flex items-center gap-2 rounded-xl border border-white/20 bg-white/10 px-4 py-2 text-[11px] font-medium text-white backdrop-blur-sm transition-all hover:bg-white/20 hover:shadow-lg",children:[(0,s.jsx)(d.A,{className:"h-4 w-4"}),"Documentos"]}),(0,s.jsxs)(O.$,{variant:"ghost",size:"sm",onClick:()=>{A(V.ordenId),i(!0)},className:"flex items-center gap-2 rounded-xl border border-white/20 bg-white/10 px-4 py-2 text-[11px] font-medium text-white backdrop-blur-sm transition-all hover:bg-white/20 hover:shadow-lg",children:[(0,s.jsx)(j.A,{className:"h-4 w-4"}),"Notificar"]}),(0,s.jsx)("button",{onClick:af,className:"ml-2 inline-flex h-9 w-9 items-center justify-center rounded-xl bg-white/10 text-white/80 backdrop-blur-sm transition-all hover:bg-red-500/80 hover:text-white hover:shadow-lg","aria-label":"Cerrar",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]})]}),(0,s.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:[{paso:1,label:"Contexto",desc:"Datos de ingreso"},{paso:2,label:"Diagn\xf3stico",desc:"Trabajo realizado"},{paso:3,label:"Costos",desc:"Valores econ\xf3micos"},{paso:4,label:"Entrega",desc:"Firma y cierre"}].map(e=>(0,s.jsx)($,{active:er===e.paso,label:e.label,desc:e.desc,step:e.paso},e.paso))})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto bg-slate-50",children:(0,s.jsxs)("div",{className:"grid gap-4 p-4 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)]",children:[(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)(R.Zp,{className:"border-slate-200 shadow-sm",children:[(0,s.jsxs)(R.aR,{className:"py-3",children:[(0,s.jsx)(R.ZB,{className:"text-sm",children:"Checklist t\xe9cnico"}),(0,s.jsx)(R.BT,{className:"text-xs",children:"Completa el flujo por pasos para no olvidar nada."})]}),(0,s.jsxs)(R.Wu,{className:"space-y-4",children:[1===er&&(0,s.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-700",children:"Datos de ingreso"}),(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Paso 1 de 4"})]}),(0,s.jsx)("p",{className:"mt-2 text-[11px] text-slate-600",children:"Revisa la informaci\xf3n de entrada antes de continuar con el diagn\xf3stico."}),(0,s.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 text-[11px] md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-700",children:"Problema:"}),(0,s.jsx)("p",{className:"mt-1 whitespace-pre-wrap text-slate-800",children:al(V.problemaReportado)})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-700",children:"Observaciones:"}),(0,s.jsx)("p",{className:"mt-1 whitespace-pre-wrap text-slate-800",children:al(V.observacionesIngreso)})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-3 md:col-span-2",children:[(0,s.jsx)("span",{className:"font-semibold text-slate-700",children:"Equipo:"}),(0,s.jsxs)("p",{className:"mt-1 text-slate-800",children:[al(V.equipoModelo)," ",V.equipoHostname?"(".concat(V.equipoHostname,")"):""]})]})]})]}),2===er&&(0,s.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-700",children:"Diagn\xf3stico y trabajo realizado"}),(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Paso 2 de 4"})]}),(0,s.jsx)("p",{className:"mt-2 text-[11px] text-slate-600",children:"Registra tus pruebas, hallazgos y acciones realizadas."}),(0,s.jsxs)("div",{className:"mt-4 rounded-xl border border-slate-200 bg-slate-50 p-3",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-700",children:"Fichas T\xe9cnicas Anexas"}),(0,s.jsx)("p",{className:"text-[11px] text-slate-500",children:"Crea y completa fichas t\xe9cnicas asociadas a esta OT."})]}),!ah&&(0,s.jsxs)(O.$,{type:"button",size:"sm",className:"h-8 bg-slate-900 text-[11px] text-white hover:bg-slate-800",onClick:()=>tA(!0),children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-1"}),"Nueva ficha"]})]}),(0,s.jsx)("div",{className:"mt-3",children:tg?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[(0,s.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Cargando fichas anexas..."]}):tf?(0,s.jsx)("div",{className:"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-[11px] text-rose-700",children:tf}):0===tp.length?(0,s.jsx)("div",{className:"rounded-lg border border-dashed border-slate-300 bg-white px-3 py-3 text-[11px] text-slate-600",children:"No hay fichas anexas creadas para esta OT."}):(0,s.jsx)("div",{className:"grid gap-2",children:tp.map(e=>(0,s.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>aL(e.id),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&aL(e.id)},className:"group relative flex w-full cursor-pointer items-start justify-between gap-3 rounded-xl border border-slate-200 bg-white px-4 py-3 shadow-sm transition hover:border-indigo-300 hover:bg-indigo-50/30 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-300",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-[12px] font-semibold text-slate-900",children:["Ficha #",e.id]}),(0,s.jsx)("span",{className:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:new Date(e.fechaCreacion).toLocaleString("es-EC")}),e.tecnicoNombre&&(0,s.jsx)("span",{className:"rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700",children:e.tecnicoNombre})]}),e.observaciones?(0,s.jsx)("p",{className:"mt-1 line-clamp-2 text-[11px] text-slate-600",children:e.observaciones}):(0,s.jsx)("p",{className:"mt-1 text-[11px] text-slate-400 italic",children:"Sin observaciones"})]}),(0,s.jsxs)("div",{className:"flex shrink-0 items-center gap-2",children:[(0,s.jsx)("span",{className:"text-[11px] font-medium text-indigo-600 opacity-90 group-hover:opacity-100"}),!ah&&(0,s.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),window.confirm("\xbfEliminar la ficha #".concat(e.id,"?"))&&a$(e.id)},className:"ml-1 inline-flex h-8 w-8 items-center justify-center rounded-lg border border-rose-200 bg-rose-50 text-rose-700 opacity-0 transition hover:bg-rose-100 group-hover:opacity-100",title:"Eliminar ficha","aria-label":"Eliminar ficha ".concat(e.id),children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]})]},e.id))})})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)("label",{className:"text-[11px] font-medium text-slate-700",children:"Diagn\xf3stico / trabajo realizado *"}),(0,s.jsx)("textarea",{value:eu,onChange:e=>eh(e.target.value),placeholder:"Describe el diagn\xf3stico, pruebas realizadas y trabajo ejecutado...",disabled:ah,className:"min-h-[110px] w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 ".concat(ah?"bg-slate-100 cursor-not-allowed opacity-70":"")}),(0,s.jsx)("label",{className:"text-[11px] font-medium text-slate-700",children:"Observaciones / recomendaciones"}),(0,s.jsx)("textarea",{value:ep,onChange:e=>eb(e.target.value),placeholder:"Notas finales para el cliente, recomendaciones, etc.",disabled:ah,className:"min-h-[110px] w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 ".concat(ah?"bg-slate-100 cursor-not-allowed opacity-70":"")})]}),(0,s.jsx)("div",{className:"mt-4 flex flex-col items-center gap-3 rounded-lg border-2 p-4 ".concat(tP?"border-emerald-300 bg-emerald-50":"border-blue-300 bg-blue-50"),children:tP?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{className:"h-6 w-6 text-emerald-600"}),(0,s.jsx)("p",{className:"text-center text-[12px] font-medium text-emerald-900",children:"✅ Conformidad de Procedimiento Firmada"}),(0,s.jsx)("p",{className:"text-center text-[11px] text-emerald-700",children:"El cliente ya ha firmado la conformidad del procedimiento."}),!ah&&(0,s.jsxs)(O.$,{type:"button",variant:"outline",onClick:()=>aA("conformidad"),className:"flex items-center gap-2 border-emerald-400 text-emerald-700 hover:bg-emerald-100",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),"Firmar Nuevamente"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.A,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)("p",{className:"text-center text-[12px] font-medium text-blue-900",children:"Obtener Firma de Conformidad del Procedimiento"}),(0,s.jsx)("p",{className:"text-center text-[11px] text-blue-700",children:"El cliente debe firmar para confirmar que acepta el procedimiento t\xe9cnico propuesto."}),!ah&&(0,s.jsxs)(O.$,{type:"button",onClick:()=>aA("conformidad"),className:"flex items-center gap-2 bg-blue-600 text-white hover:bg-blue-700",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),"Abrir Panel de Firma"]})]})})]}),3===er&&V&&(0,s.jsx)(k,{ordenId:V.ordenId,estado:V.estado}),4===er&&(0,s.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-700",children:"Firma de Recibo de Entrega"}),(0,s.jsx)("span",{className:"text-[10px] text-slate-400",children:"Paso 4 de 4"})]}),(0,s.jsx)("p",{className:"mt-2 text-[11px] text-slate-600",children:"El equipo est\xe1 listo para ser entregado. El cliente debe firmar el recibo de conformidad."}),tP?(0,s.jsx)("div",{className:"mt-4 flex flex-col items-center justify-center rounded-lg border-2 p-6 ".concat(tF?"border-emerald-400 bg-emerald-100":"border-dashed border-emerald-300 bg-emerald-50"),children:tF?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{className:"mb-3 h-8 w-8 text-emerald-600"}),(0,s.jsx)("p",{className:"mb-2 text-center text-[13px] font-medium text-emerald-900",children:"✅ Recibo de Entrega Firmado"}),(0,s.jsx)("p",{className:"text-center text-[11px] text-emerald-700",children:"El cliente ya ha firmado el recibo de entrega del equipo."}),!ah&&(0,s.jsxs)(O.$,{type:"button",variant:"outline",onClick:aR,className:"mt-3 flex items-center gap-2 border-emerald-400 text-emerald-700 hover:bg-emerald-100",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),"Firmar Nuevamente"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.A,{className:"mb-3 h-8 w-8 text-emerald-600"}),(0,s.jsx)("p",{className:"mb-2 text-center text-[13px] font-medium text-emerald-900",children:"Obtener Firma de Recibo de Entrega"}),(0,s.jsx)("p",{className:"text-center text-[11px] text-slate-600 mb-4",children:"El cliente o un tercero autorizado debe firmar para confirmar la entrega del equipo."}),!ah&&(0,s.jsxs)(O.$,{type:"button",onClick:aR,className:"flex items-center gap-2 bg-emerald-600 text-sm text-white hover:bg-emerald-700",children:[(0,s.jsx)(f.A,{className:"h-4 w-4"}),"Abrir Panel de Firma"]})]})}):(0,s.jsxs)("div",{className:"mt-4 flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-amber-300 bg-amber-50 p-6",children:[(0,s.jsx)(f.A,{className:"mb-3 h-8 w-8 text-amber-500"}),(0,s.jsx)("p",{className:"mb-2 text-center text-[13px] font-medium text-amber-900",children:"⚠️ Firma de Conformidad Requerida"}),(0,s.jsx)("p",{className:"text-center text-[11px] text-amber-700",children:"El cliente debe firmar primero la conformidad del procedimiento (Paso 2) antes de poder firmar el recibo de entrega."}),(0,s.jsx)(O.$,{type:"button",variant:"outline",onClick:()=>ei(2),className:"mt-3 flex items-center gap-2 border-amber-400 text-amber-700 hover:bg-amber-100",children:"Ir al Paso 2"})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-1 text-[11px] text-slate-500",children:[(0,s.jsxs)("span",{children:["Pasos: ",er," / 4"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[er>1&&(0,s.jsx)(O.$,{type:"button",variant:"outline",size:"sm",className:"h-8 border-slate-300 text-[11px] text-slate-700",onClick:()=>ei(e=>{let t=e>1?e-1:e;return em(H(t)),t}),children:"Anterior"}),er<4&&(0,s.jsx)(O.$,{type:"button",variant:"outline",size:"sm",className:"h-8 border-slate-300 text-[11px] text-slate-700",onClick:()=>ei(e=>{let t=e<4?e+1:e;return em(H(t)),t}),children:"Siguiente"})]})]})]})]})}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)(R.Zp,{className:"border-slate-200 shadow-sm",children:[(0,s.jsx)(R.aR,{className:"py-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(R.ZB,{className:"text-sm",children:"Im\xe1genes"}),(0,s.jsx)(R.BT,{className:"text-xs",children:"Clic para ampliar. Filtra por categor\xeda."})]}),(0,s.jsx)(D.p,{placeholder:"Filtro...",value:es,onChange:e=>el(e.target.value),className:"h-9 w-40 text-xs"})]})}),(0,s.jsxs)(R.Wu,{className:"space-y-3",children:[(0,s.jsx)("div",{className:"max-h-[360px] overflow-y-auto rounded-lg border border-slate-200 bg-white p-2",children:W&&W.length>0?(()=>{let e=es.trim().toUpperCase(),t=Array.from(new Set(W.map(e=>e.categoria))).sort().filter(t=>!e||t.toUpperCase().includes(e));return 0===t.length?(0,s.jsx)("div",{className:"flex h-[220px] items-center justify-center text-[11px] text-slate-400",children:"No hay im\xe1genes para ese filtro."}):(0,s.jsx)("div",{className:"space-y-4",children:t.map(e=>{let t=W.filter(t=>t.categoria===e);return 0===t.length?null:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"rounded-full bg-slate-900 px-2 py-[2px] text-[10px] font-semibold uppercase tracking-wide text-white",children:e}),(0,s.jsxs)("span",{className:"text-[10px] text-slate-500",children:[t.length," imagen",t.length>1?"es":""]})]}),(0,s.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:t.map(e=>(0,s.jsxs)("div",{className:"group relative h-24 w-28 overflow-hidden rounded-lg border border-slate-200 bg-slate-100 cursor-pointer",onClick:()=>ea(e.ruta),children:[(0,s.jsx)(y.A,{src:e.ruta,alt:e.descripcion||"Imagen OT",className:"h-full w-full object-cover transition-transform group-hover:scale-110"}),(0,s.jsx)("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent px-1.5 pb-1.5 pt-3",children:(0,s.jsx)("p",{className:"truncate text-[9px] text-slate-100",children:new Date(e.fechaSubida).toLocaleString()})})]},e.id))})]},e)})})})():(0,s.jsx)("div",{className:"flex h-[220px] items-center justify-center text-[11px] text-slate-400",children:"No hay im\xe1genes registradas."})}),ah?(0,s.jsx)("div",{className:"rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 p-6",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 text-center",children:[(0,s.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-slate-100",children:(0,s.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD12"})}),(0,s.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"Orden cerrada - Solo lectura"}),(0,s.jsx)("p",{className:"text-xs text-slate-400",children:"No se pueden subir m\xe1s im\xe1genes"})]})}):(0,s.jsxs)("div",{className:"rounded-xl border-2 border-dashed border-slate-200 bg-gradient-to-br from-slate-50 to-white p-4 transition-all hover:border-blue-300 hover:bg-blue-50/30",children:[(0,s.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-blue-100",children:(0,s.jsx)(N.A,{className:"h-4 w-4 text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-slate-700",children:"Subir nuevas im\xe1genes"}),(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:"Arrastra o selecciona archivos"})]})]}),(0,s.jsxs)(q.l6,{value:K,onValueChange:ee,children:[(0,s.jsx)(q.bq,{className:"h-8 w-[130px] border-slate-200 bg-white text-xs shadow-sm",children:(0,s.jsx)(q.yv,{placeholder:"Categor\xeda"})}),(0,s.jsxs)(q.gC,{children:[(0,s.jsx)(q.eb,{value:"INGRESO",children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-500"})," Ingreso"]})}),(0,s.jsx)(q.eb,{value:"DIAGNOSTICO",children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-blue-500"})," Diagn\xf3stico"]})}),(0,s.jsx)(q.eb,{value:"REPARACION",children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-orange-500"})," Reparaci\xf3n"]})}),(0,s.jsx)(q.eb,{value:"ENTREGA",children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-purple-500"})," Entrega"]})}),(0,s.jsx)(q.eb,{value:"OTRO",children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-slate-400"})," Otro"]})})]})]})]}),(0,s.jsxs)("label",{className:"group relative flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-slate-200 bg-white py-6 transition-all hover:border-blue-400 hover:bg-blue-50/50",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("border-blue-400","bg-blue-50")},onDragLeave:e=>{e.currentTarget.classList.remove("border-blue-400","bg-blue-50")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("border-blue-400","bg-blue-50");let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&Q(e=>[...e,...t])},children:[(0,s.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>Q(t=>[...t,...Array.from(e.target.files||[])]),className:"absolute inset-0 cursor-pointer opacity-0"}),(0,s.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-slate-100 transition-all group-hover:bg-blue-100 group-hover:scale-110",children:(0,s.jsx)(v.A,{className:"h-6 w-6 text-slate-400 transition-colors group-hover:text-blue-500"})}),(0,s.jsx)("p",{className:"mt-2 text-xs font-medium text-slate-600",children:"Haz clic o arrastra im\xe1genes aqu\xed"}),(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:"PNG, JPG hasta 10MB cada una"})]}),(0,s.jsx)("div",{className:"mt-3 flex justify-center",children:(0,s.jsxs)("label",{className:"group flex cursor-pointer items-center gap-2 rounded-lg border border-emerald-200 bg-gradient-to-r from-emerald-50 to-green-50 px-4 py-2.5 transition-all hover:border-emerald-400 hover:from-emerald-100 hover:to-green-100 hover:shadow-md",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",capture:"environment",onChange:e=>{let t=Array.from(e.target.files||[]);t.length>0&&Q(e=>[...e,...t]),e.target.value=""},className:"hidden"}),(0,s.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-emerald-100 transition-all group-hover:bg-emerald-200 group-hover:scale-110",children:(0,s.jsx)(v.A,{className:"h-4 w-4 text-emerald-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-emerald-700",children:"Tomar foto"}),(0,s.jsx)("p",{className:"text-[10px] text-emerald-500",children:"Usar c\xe1mara del dispositivo"})]})]})}),Y.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-[11px] font-medium text-slate-600",children:[Y.length," imagen",Y.length>1?"es":""," seleccionada",Y.length>1?"s":""]}),(0,s.jsx)("button",{onClick:()=>Q([]),className:"text-[10px] text-red-500 hover:text-red-600 hover:underline",children:"Quitar todas"})]}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-2 sm:grid-cols-5 md:grid-cols-6",children:Y.map((e,t)=>(0,s.jsxs)("div",{className:"group relative aspect-square overflow-hidden rounded-lg border border-slate-200 bg-slate-100 shadow-sm transition-all hover:shadow-md hover:scale-[1.02]",children:[(0,s.jsx)("img",{src:URL.createObjectURL(e),alt:"Previsualizaci\xf3n",className:"h-full w-full object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 transition-opacity group-hover:opacity-100"}),(0,s.jsx)("button",{onClick:()=>Q(e=>e.filter((e,a)=>a!==t)),className:"absolute right-1 top-1 flex h-6 w-6 items-center justify-center rounded-full bg-red-500/90 text-white opacity-0 shadow-lg transition-all hover:bg-red-600 hover:scale-110 group-hover:opacity-100",title:"Quitar imagen",children:(0,s.jsx)(x.A,{className:"h-3.5 w-3.5"})}),(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 px-1.5 py-1",children:[(0,s.jsx)("p",{className:"truncate text-[9px] font-medium text-white",children:e.name}),(0,s.jsxs)("p",{className:"text-[8px] text-slate-300",children:[(e.size/1024).toFixed(0)," KB"]})]})]},t))})]}),(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:0===Y.length?"Selecciona im\xe1genes para subir":"Listo para subir ".concat(Y.length," archivo").concat(Y.length>1?"s":"")}),(0,s.jsxs)(O.$,{onClick:ay,disabled:0===Y.length,className:"flex h-9 items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-500 px-4 text-xs font-medium text-white shadow-md transition-all hover:from-blue-700 hover:to-blue-600 hover:shadow-lg disabled:from-slate-300 disabled:to-slate-300 disabled:shadow-none",children:[(0,s.jsx)(N.A,{className:"h-4 w-4"}),"Subir im\xe1genes"]})]})]})]})]})})]})}),(0,s.jsx)("footer",{className:"sticky bottom-0 z-20 border-t border-slate-200 bg-white px-5 py-3",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 text-[11px] text-slate-600",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{children:["Usa ",(0,s.jsx)("span",{className:"font-semibold",children:"Guardar"})," o"," ",(0,s.jsx)("span",{className:"font-semibold",children:"Cerrar OT"})," cuando est\xe9 lista."]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium ".concat(tP?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-500"),children:[tP?(0,s.jsx)(c.A,{className:"h-3 w-3"}):null,"Conformidad"]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-medium ".concat(tF?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-500"),children:[tF?(0,s.jsx)(c.A,{className:"h-3 w-3"}):null,"Recibo"]})]})]}),ah?(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded-lg bg-slate-100 px-4 py-2",children:[(0,s.jsx)("span",{className:"text-lg",children:"\uD83D\uDD12"}),(0,s.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Orden Cerrada - Solo lectura"})]}):(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(O.$,{type:"button",variant:"outline",size:"sm",disabled:eJ,onClick:()=>av(!1),className:"flex h-9 items-center gap-2 border-slate-300 text-[11px] text-slate-700",children:[eJ&&(0,s.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Guardar"]}),(0,s.jsxs)(O.$,{type:"button",size:"sm",disabled:eJ||!tF,onClick:aw,className:"flex h-9 items-center gap-2 text-[11px] ".concat(tF?"bg-slate-900 text-slate-50 hover:bg-slate-800":"bg-slate-300 text-slate-500 cursor-not-allowed"),title:tF?"Cerrar orden de trabajo":"Requiere firma de recibo de entrega",children:[eJ&&(0,s.jsx)(o.A,{className:"h-4 w-4 animate-spin"}),"Cerrar OT"]})]})]})}),et&&(0,s.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80",onClick:()=>ea(null),children:(0,s.jsxs)("div",{className:"relative mx-4 max-h-[90vh] max-w-5xl",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:()=>ea(null),className:"absolute right-2 top-2 rounded-full bg-black/70 p-2 text-white hover:bg-black/90 z-50",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})}),(0,s.jsx)(y.A,{src:et,alt:"Vista ampliada",className:"max-h-[90vh] w-full rounded-md object-contain shadow-2xl"})]})}),a&&null!==S&&(0,s.jsx)(w.A,{otId:S,open:a,onClose:()=>i(!1)})]})}),(0,s.jsx)(U,{open:tr,onClose:aM,loading:tn,error:tc,data:tx}),(0,s.jsx)(C.A,{open:tv,fichaId:ty,onClose:()=>{tw(!1),tC(null)},onSaved:()=>{V&&aB(V.ordenId,V.equipoId)}}),V&&(0,s.jsx)(z.V,{open:tS,clienteCedula:V.clienteCedula||"",tecnicoCedula:V.tecnicoCedula||"",ordenTrabajoId:V.ordenId,onClose:()=>tA(!1),onCreated:e=>{tA(!1),tC(e),tw(!0),V&&aB(V.ordenId,V.equipoId)}}),tE&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm",onMouseDown:e=>{e.target===e.currentTarget&&tT(!1)},children:(0,s.jsxs)("div",{className:"relative mx-3 w-full max-w-2xl rounded-2xl border border-slate-200 bg-white shadow-2xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 bg-blue-50 px-6 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(f.A,{className:"h-5 w-5 text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"aceptacion"===tI?"Firma de Aceptaci\xf3n":"Firma de Conformidad del Procedimiento"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Dibuja tu firma en el \xe1rea de abajo"})]})]}),(0,s.jsx)("button",{onClick:()=>tT(!1),className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-200 text-slate-700 hover:bg-slate-300","aria-label":"Cerrar",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("p",{className:"mb-3 text-sm text-slate-700 font-medium",children:"Firma"}),(0,s.jsx)("canvas",{ref:tR,width:600,height:200,onMouseDown:aI,onMouseMove:ak,onMouseUp:aO,onMouseLeave:aO,onTouchStart:aI,onTouchMove:ak,onTouchEnd:aO,style:{border:"2px solid #e2e8f0",borderRadius:"8px",cursor:"crosshair",backgroundColor:"#fff",width:"100%",height:"200px"}})]}),(0,s.jsxs)("div",{className:"flex gap-3 border-t border-slate-100 bg-slate-50 px-6 py-4",children:[(0,s.jsx)(O.$,{type:"button",variant:"outline",onClick:aE,className:"flex-1",children:"Limpiar"}),(0,s.jsx)(O.$,{type:"button",variant:"outline",onClick:()=>tT(!1),className:"flex-1",children:"Cancelar"}),(0,s.jsx)(O.$,{type:"button",onClick:aT,className:"flex-1 bg-blue-600 text-white hover:bg-blue-700",children:"Guardar Firma"})]})]})}),tJ&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm",onMouseDown:e=>{e.target===e.currentTarget&&tZ(!1)},children:(0,s.jsxs)("div",{className:"relative mx-3 w-full max-w-2xl rounded-2xl border border-slate-200 bg-white shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 bg-emerald-50 px-6 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(f.A,{className:"h-5 w-5 text-emerald-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:"Firma de Recibo de Entrega"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Confirma qui\xe9n recibe el equipo"})]})]}),(0,s.jsx)("button",{onClick:()=>tZ(!1),className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-200 text-slate-700 hover:bg-slate-300","aria-label":"Cerrar",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"p-6 space-y-5",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-3 text-sm font-medium text-slate-700",children:"\xbfQui\xe9n recibe el equipo?"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>tQ("cliente"),className:"flex-1 p-4 rounded-xl border-2 text-left transition-all ".concat("cliente"===tY?"border-emerald-500 bg-emerald-50":"border-slate-200 hover:border-slate-300"),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat("cliente"===tY?"border-emerald-500 bg-emerald-500":"border-slate-300"),children:"cliente"===tY&&(0,s.jsx)(c.A,{className:"h-3 w-3 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-900",children:"El Cliente"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:(null==V?void 0:V.clienteNombre)||"—"})]})]})}),(0,s.jsx)("button",{type:"button",onClick:()=>tQ("tercero"),className:"flex-1 p-4 rounded-xl border-2 text-left transition-all ".concat("tercero"===tY?"border-emerald-500 bg-emerald-50":"border-slate-200 hover:border-slate-300"),children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat("tercero"===tY?"border-emerald-500 bg-emerald-500":"border-slate-300"),children:"tercero"===tY&&(0,s.jsx)(c.A,{className:"h-3 w-3 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-900",children:"Otra Persona"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Un tercero autorizado"})]})]})})]})]}),"tercero"===tY&&(0,s.jsxs)("div",{className:"p-4 rounded-xl border border-slate-200 bg-slate-50 space-y-3",children:[(0,s.jsx)("p",{className:"text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Datos de quien recibe"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-slate-600 mb-1 block",children:"Nombre completo *"}),(0,s.jsx)(D.p,{value:tK,onChange:e=>t0(e.target.value),placeholder:"Nombre y apellido",className:"h-9"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-slate-600 mb-1 block",children:"C\xe9dula/DNI *"}),(0,s.jsx)(D.p,{value:t1,onChange:e=>t2(e.target.value),placeholder:"0000000000",className:"h-9"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-slate-600 mb-1 block",children:"Relaci\xf3n con el cliente"}),(0,s.jsx)(D.p,{value:t5,onChange:e=>t3(e.target.value),placeholder:"Ej: Familiar, Empleado, Representante...",className:"h-9"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-3 text-sm text-slate-700 font-medium",children:"Firma"}),(0,s.jsx)("canvas",{ref:t_,width:600,height:200,onMouseDown:aP,onMouseMove:az,onMouseUp:aF,onMouseLeave:aF,onTouchStart:aP,onTouchMove:az,onTouchEnd:aF,style:{border:"2px solid #e2e8f0",borderRadius:"8px",cursor:"crosshair",backgroundColor:"#fff",width:"100%",height:"200px"}})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 border-t border-slate-100 bg-slate-50 px-6 py-4",children:[(0,s.jsx)(O.$,{type:"button",variant:"outline",onClick:aD,className:"flex-1",children:"Limpiar"}),(0,s.jsx)(O.$,{type:"button",variant:"outline",onClick:()=>tZ(!1),className:"flex-1",children:"Cancelar"}),(0,s.jsx)(O.$,{type:"button",onClick:aq,className:"flex-1 bg-emerald-600 text-white hover:bg-emerald-700",children:"Guardar Firma"})]})]})}),t$&&V&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm",onMouseDown:e=>{e.target===e.currentTarget&&tU(!1)},children:(0,s.jsxs)("div",{className:"relative mx-3 w-full max-w-2xl rounded-2xl border border-slate-200 bg-white shadow-2xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 bg-slate-50 px-6 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(d.A,{className:"h-5 w-5 text-slate-600"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-semibold text-slate-900",children:["Documentos de la Orden #",V.numeroOrden]}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Firmas y documentos generados"})]})]}),(0,s.jsx)("button",{onClick:()=>tU(!1),className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-200 text-slate-700 hover:bg-slate-300","aria-label":"Cerrar",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Documentos de Firmas"}),(0,s.jsxs)("div",{className:"grid gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-3 ".concat(tP?"border-emerald-200 bg-emerald-50":"border-slate-200 bg-slate-50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg ".concat(tP?"bg-emerald-100":"bg-slate-200"),children:(0,s.jsx)(d.A,{className:"h-5 w-5 ".concat(tP?"text-emerald-600":"text-slate-400")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-900",children:"Conformidad de Procedimiento"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:tP?"✅ Documento firmado".concat(tB?" - ".concat((0,F.r6)(tB)):""):"Pendiente de firma"})]})]}),tP&&(0,s.jsx)(O.$,{type:"button",variant:"outline",size:"sm",onClick:()=>aS(V.numeroOrden||"","Acta_Conformidad_".concat(V.numeroOrden,".pdf")),className:"text-xs",children:"Ver PDF"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-3 ".concat(tF?"border-emerald-200 bg-emerald-50":"border-slate-200 bg-slate-50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg ".concat(tF?"bg-emerald-100":"bg-slate-200"),children:(0,s.jsx)(d.A,{className:"h-5 w-5 ".concat(tF?"text-emerald-600":"text-slate-400")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-900",children:"Recibo de Entrega"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:tF?"✅ Documento firmado".concat(tG?" - ".concat((0,F.r6)(tG)):""):"Pendiente de firma"})]})]}),tF&&(0,s.jsx)(O.$,{type:"button",variant:"outline",size:"sm",onClick:()=>aS(V.numeroOrden||"","Acta_Entrega_".concat(V.numeroOrden,".pdf")),className:"text-xs",children:"Ver PDF"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3 pt-2 border-t border-slate-100",children:[(0,s.jsx)("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Fichas T\xe9cnicas"}),0===tp.length?(0,s.jsx)("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-slate-50 p-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-slate-200",children:(0,s.jsx)(d.A,{className:"h-5 w-5 text-slate-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-900",children:"Ficha T\xe9cnica"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"No hay fichas t\xe9cnicas generadas"})]})]})}):(0,s.jsx)("div",{className:"grid gap-3",children:tp.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-blue-200 bg-blue-50 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100",children:(0,s.jsx)(d.A,{className:"h-5 w-5 text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-slate-900",children:["Ficha T\xe9cnica #",e.id]}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[e.tecnicoNombre||"Sin t\xe9cnico"," \xb7 ",new Date(e.fechaCreacion).toLocaleDateString()]})]})]}),(0,s.jsx)(O.$,{type:"button",variant:"outline",size:"sm",onClick:()=>aS(V.numeroOrden||"","Ficha_Tecnica_".concat(e.id,".pdf")),className:"text-xs",children:"Ver PDF"})]},e.id))})]})]}),(0,s.jsx)("div",{className:"border-t border-slate-100 bg-slate-50 px-6 py-3",children:(0,s.jsx)(O.$,{type:"button",variant:"outline",onClick:()=>tU(!1),className:"w-full",children:"Cerrar"})})]})})]})})}}}]);