(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{1733:(e,t,s)=>{"use strict";s.d(t,{JR:()=>i,ff:()=>a});let i="";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.startsWith("/")?e:"/".concat(e),a="".concat(i).concat(s),n=await fetch(a,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(!n.ok){let e=await n.text();throw Error("Error ".concat(n.status,": ").concat(e||n.statusText))}try{return await n.json()}catch(e){return null}}},5451:()=>{},8468:(e,t,s)=>{Promise.resolve().then(s.bind(s,9168))},9168:(e,t,s)=>{"use strict";s.d(t,{default:()=>j});var i=s(5155),a=s(2115);function n(e){let{cedula:t,onClose:s,onVerified:n,onVerify:o}=e,[l,r]=(0,a.useState)(["","","","","",""]),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(null),x=(0,a.useRef)([]),h=(0,a.useMemo)(()=>l.join(""),[l]);(0,a.useEffect)(()=>{var e;null==(e=x.current[0])||e.focus();let t=e=>"Escape"===e.key&&s();return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s]);let g=e=>{var t;let s=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(!s)return;e.preventDefault(),r(s.split("").concat(Array(6-s.length).fill(""))),p(null);let i=Math.min(s.length,6)-1;null==(t=x.current[i])||t.focus()},m=async()=>{if(6!==h.length)return void p("Ingresa los 6 d\xedgitos.");d(!0),p(null);try{let e=await o(h);if(e.ok&&e.consultaToken)return void n(e.consultaToken);p(e.message||"OTP inv\xe1lido.")}catch(e){p((null==e?void 0:e.message)||"Error al validar OTP.")}finally{d(!1)}};return(0,i.jsx)("div",{className:"otpOverlay",role:"dialog","aria-modal":"true",children:(0,i.jsxs)("div",{className:"otpCard",children:[(0,i.jsxs)("div",{className:"otpTop",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{children:"Verificaci\xf3n de seguridad"}),(0,i.jsxs)("p",{children:["Enviamos un c\xf3digo a tu correo. ",(0,i.jsxs)("span",{className:"otpMuted",children:["C\xe9dula: ",t]})]})]}),(0,i.jsx)("button",{className:"otpClose",onClick:s,"aria-label":"Cerrar",children:"✕"})]}),(0,i.jsx)("div",{className:"otpInputs",children:l.map((e,t)=>(0,i.jsx)("input",{ref:e=>{x.current[t]=e},value:e,inputMode:"numeric",autoComplete:"one-time-code",onPaste:g,onKeyDown:e=>{var s,i,a;"Backspace"===e.key&&!l[t]&&t>0&&(null==(a=x.current[t-1])||a.focus()),"ArrowLeft"===e.key&&t>0&&(null==(s=x.current[t-1])||s.focus()),"ArrowRight"===e.key&&t<5&&(null==(i=x.current[t+1])||i.focus())},onChange:e=>((e,t)=>{var s;let i=t.replace(/\D/g,"").slice(-1);r(t=>{let s=[...t];return s[e]=i,s}),p(null),i&&e<5&&(null==(s=x.current[e+1])||s.focus())})(t,e.target.value),className:"otpDigit"},t))}),u&&(0,i.jsx)("div",{className:"otpError",children:u}),(0,i.jsx)("button",{className:"otpBtn",onClick:m,disabled:c,children:c?"Validando...":"Verificar"}),(0,i.jsx)("div",{className:"otpHint",children:"\xbfNo te lleg\xf3? Revisa spam o espera 1–2 minutos."})]})})}s(5451);var o=s(1141),l=s(1733);async function r(e,t){let s=await fetch("".concat(l.JR).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await s.text(),a=i?JSON.parse(i):null;if(!s.ok)throw Error((null==a?void 0:a.message)||(null==a?void 0:a.mensaje)||"HTTP ".concat(s.status));return a}let c={sendOtp:e=>r("/api/public/consultas/otp",e),verifyOtp:e=>r("/api/public/consultas/otp/validar",e),getHistorial:e=>r("/api/public/consultas/historial",e),getProcedimiento:e=>r("/api/public/consultas/procedimiento",e)};var d=s(5229),u=s(6485),p=s(2508),x=s(2056),h=s(3842),g=s(1761),m=s(6835),f=s(7066),v=s(5704);function j(){var e,t,s;let[l,r]=(0,a.useState)(""),[j,S]=(0,a.useState)(""),[w,C]=(0,a.useState)("historial"),[k,T]=(0,a.useState)(""),[E,A]=(0,a.useState)(!1),[R,z]=(0,a.useState)(!1),[O,D]=(0,a.useState)(null),[I,P]=(0,a.useState)(null),[M,W]=(0,a.useState)(null),[H,B]=(0,a.useState)(null),[L,V]=(0,a.useState)(null),_=(0,a.useRef)(null),q=(0,a.useMemo)(()=>!!l.trim()&&!!j.trim()&&("procedimiento"!==w||!!k.trim())&&!!L,[l,j,w,k,L]),U=async e=>{if(e.preventDefault(),B(null),P(null),W(null),D(null),!L)return void B("Por favor, completa el captcha.");z(!0);try{await c.sendOtp({cedula:l.trim(),correo:j.trim(),recaptchaToken:L}),A(!0)}catch(e){var t;B((null==e?void 0:e.message)||"No se pudo solicitar el OTP."),V(null),null==(t=_.current)||t.reset()}finally{z(!1)}},Z=async e=>await c.verifyOtp({cedula:l.trim(),codigo:e}),F=async e=>{z(!0),B(null);try{if("historial"===w){let t=await c.getHistorial({consultaToken:e});P(t)}else{let t=await c.getProcedimiento({consultaToken:e,numeroOrden:k.trim()});W(t)}}catch(e){B((null==e?void 0:e.message)||"Error al consultar. Verifique los datos.")}finally{z(!1)}};return(0,i.jsx)("div",{className:"consulta-wrapper",children:(0,i.jsxs)("div",{className:"consulta-inner",children:[(0,i.jsxs)("div",{className:"consulta-header",children:[(0,i.jsx)("h1",{children:"\xbfQuieres saber el estado de tu reparaci\xf3n?"}),(0,i.jsx)("p",{children:"Consulta tu historial completo o verifica el avance de un procedimiento activo."})]}),(0,i.jsxs)("div",{className:"consulta-container",children:[(0,i.jsxs)("form",{onSubmit:U,children:[(0,i.jsx)("label",{children:"C\xe9dula"}),(0,i.jsx)("input",{value:l,onChange:e=>r(e.target.value),required:!0}),(0,i.jsx)("label",{children:"Correo electr\xf3nico*"}),(0,i.jsx)("input",{type:"email",value:j,onChange:e=>S(e.target.value),required:!0}),(0,i.jsx)("small",{children:"*Se enviar\xe1 un c\xf3digo de verificaci\xf3n a este correo."}),(0,i.jsxs)("div",{className:"radio-group",children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",checked:"historial"===w,onChange:()=>C("historial")}),"Historial"]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",checked:"procedimiento"===w,onChange:()=>C("procedimiento")}),"Procedimiento"]})]}),(0,i.jsx)("label",{style:{opacity:"procedimiento"!==w?.5:1},children:"N\xb0 de procedimiento"}),(0,i.jsx)("input",{value:k,onChange:e=>T(e.target.value),placeholder:"Ej: OT-00012",disabled:"procedimiento"!==w,style:{opacity:"procedimiento"!==w?.5:1}}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0"},children:(0,i.jsx)(o.A,{ref:_,sitekey:v.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY||"",onChange:e=>V(e),theme:"dark"})}),(0,i.jsx)("button",{type:"submit",disabled:!q||R,children:R?"Procesando...":"Consultar"})]}),(0,i.jsxs)("div",{className:"consulta-results",children:[H&&(0,i.jsx)("div",{className:"consulta-error",children:H}),!H&&R&&(0,i.jsx)("div",{className:"consulta-loading",children:"Consultando informaci\xf3n..."}),M&&(0,i.jsxs)("div",{className:"result-card",children:[(0,i.jsxs)("div",{className:"result-header-row",children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)("h3",{children:M.numeroOrden}),I&&(0,i.jsx)("span",{style:{fontSize:11,opacity:.5,marginTop:4,fontWeight:600},children:"VISTA DE DETALLE"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("div",{className:"status-badge-lg",children:M.estado.replace(/_/g," ")}),(0,i.jsx)("button",{onClick:()=>{W(null)},className:"btn-close-detail",title:"Cerrar detalle y volver",children:(0,i.jsx)(d.A,{size:18})})]})]}),(0,i.jsxs)("div",{className:"result-section",children:[(0,i.jsxs)("div",{className:"result-section-title",children:[(0,i.jsx)(u.A,{size:14})," Resumen"]}),(0,i.jsxs)("div",{className:"info-grid-3",children:[(0,i.jsx)(b,{label:"Tipo Servicio",value:M.tipoServicio}),(0,i.jsx)(b,{label:"Fecha Ingreso",value:y(M.fechaHoraIngreso)}),(0,i.jsx)(b,{label:"Fecha Entrega",value:M.fechaHoraEntrega?y(M.fechaHoraEntrega):"Pendiente"})]})]}),(0,i.jsxs)("div",{className:"result-section",children:[(0,i.jsxs)("div",{className:"result-section-title",children:[(0,i.jsx)(p.A,{size:14})," Dispositivo"]}),(0,i.jsxs)("div",{className:"info-grid-2",children:[(0,i.jsx)(b,{label:"Equipo",value:M.equipo?"".concat(M.equipo.marca," ").concat(M.equipo.modelo):"N/A"}),(0,i.jsx)(b,{label:"N\xb0 Serie",value:null==(e=M.equipo)?void 0:e.numeroSerie})]}),M.accesorios&&(0,i.jsxs)("div",{className:"text-box",style:{fontSize:"13px",padding:"10px"},children:[(0,i.jsx)("span",{style:{opacity:.6,display:"block",marginBottom:4,fontSize:11},children:"Accesorios:"}),M.accesorios]})]}),(0,i.jsxs)("div",{className:"result-section",children:[(0,i.jsxs)("div",{className:"result-section-title",children:[(0,i.jsx)(x.A,{size:14})," Reporte Inicial"]}),(0,i.jsx)("div",{className:"text-box",children:null!=(t=M.problemaReportado)?t:"Sin detalle."}),M.observacionesIngreso&&(0,i.jsxs)("div",{className:"text-box",style:{marginTop:8},children:[(0,i.jsx)("span",{style:{opacity:.6,display:"block",marginBottom:4,fontSize:11},children:"Estado f\xedsico al ingreso:"}),M.observacionesIngreso]})]}),(M.diagnosticoTrabajo||M.observacionesRecomendaciones||M.motivoCierre)&&(0,i.jsxs)("div",{className:"result-section",children:[(0,i.jsxs)("div",{className:"result-section-title",style:{color:"#a78bfa"},children:[(0,i.jsx)(h.A,{size:14})," Informe T\xe9cnico"]}),M.diagnosticoTrabajo&&(0,i.jsxs)("div",{className:"text-box",children:[(0,i.jsx)("span",{style:{opacity:.6,display:"block",marginBottom:4,fontSize:11,fontWeight:"bold"},children:"TRABAJO REALIZADO:"}),M.diagnosticoTrabajo]}),M.observacionesRecomendaciones&&(0,i.jsxs)("div",{className:"text-box",children:[(0,i.jsx)("span",{style:{opacity:.6,display:"block",marginBottom:4,fontSize:11,fontWeight:"bold"},children:"RECOMENDACIONES:"}),M.observacionesRecomendaciones]}),M.motivoCierre&&(0,i.jsxs)("div",{className:"text-box danger",children:[(0,i.jsx)("span",{style:{color:"#fca5a5",display:"block",marginBottom:4,fontSize:11,fontWeight:"bold"},children:"MOTIVO DE NO REPARACI\xd3N / CIERRE:"}),M.motivoCierre]})]}),M.costos&&M.costos.length>0&&(0,i.jsxs)("div",{className:"result-section",children:[(0,i.jsxs)("div",{className:"result-section-title",style:{color:"#10b981"},children:[(0,i.jsx)(g.A,{size:14})," Detalle de Costos (",M.costos.length," items)"]}),(0,i.jsxs)("div",{style:{backgroundColor:"#1f2937",borderRadius:"8px",overflow:"hidden",border:"1px solid #374151"},children:[(0,i.jsx)("div",{style:{maxHeight:"200px",overflowY:"auto"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[(0,i.jsx)("thead",{style:{position:"sticky",top:0,zIndex:1},children:(0,i.jsxs)("tr",{style:{backgroundColor:"#374151"},children:[(0,i.jsx)("th",{style:{padding:"8px 10px",textAlign:"left",color:"#9ca3af",fontWeight:600,fontSize:10,textTransform:"uppercase"},children:"Descripci\xf3n"}),(0,i.jsx)("th",{style:{padding:"8px 10px",textAlign:"center",color:"#9ca3af",fontWeight:600,fontSize:10,textTransform:"uppercase",width:"70px"},children:"Tipo"}),(0,i.jsx)("th",{style:{padding:"8px 10px",textAlign:"right",color:"#9ca3af",fontWeight:600,fontSize:10,textTransform:"uppercase",width:"70px"},children:"P.Unit"}),(0,i.jsx)("th",{style:{padding:"8px 10px",textAlign:"center",color:"#9ca3af",fontWeight:600,fontSize:10,textTransform:"uppercase",width:"40px"},children:"Qty"}),(0,i.jsx)("th",{style:{padding:"8px 10px",textAlign:"right",color:"#9ca3af",fontWeight:600,fontSize:10,textTransform:"uppercase",width:"80px"},children:"Subtotal"})]})}),(0,i.jsx)("tbody",{children:M.costos.map((e,t)=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #374151"},children:[(0,i.jsx)("td",{style:{padding:"8px 10px",color:"#e5e7eb",fontSize:"12px"},children:e.descripcion}),(0,i.jsx)("td",{style:{padding:"8px 10px",textAlign:"center"},children:(0,i.jsx)("span",{style:{backgroundColor:"SERVICIO"===e.tipo?"#3b82f6":"#8b5cf6",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"9px",fontWeight:600},children:"SERVICIO"===e.tipo?"SERV":"PROD"})}),(0,i.jsxs)("td",{style:{padding:"8px 10px",textAlign:"right",color:"#9ca3af",fontSize:"12px"},children:["$",N(e.costoUnitario)]}),(0,i.jsx)("td",{style:{padding:"8px 10px",textAlign:"center",color:"#9ca3af",fontSize:"12px"},children:e.cantidad}),(0,i.jsxs)("td",{style:{padding:"8px 10px",textAlign:"right",color:"#e5e7eb",fontWeight:500,fontSize:"12px"},children:["$",N(e.subtotal)]})]},t))})]})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",backgroundColor:"#10b981",borderTop:"2px solid #059669"},children:[(0,i.jsx)("span",{style:{fontWeight:700,fontSize:"13px",color:"white"},children:"TOTAL A PAGAR"}),(0,i.jsxs)("span",{style:{fontWeight:700,fontSize:"16px",color:"white"},children:["$",N(null!=(s=M.totalCostos)?s:0)]})]})]})]}),M.estado&&(M.estado.toUpperCase().includes("CIERRE")||M.estado.toUpperCase().includes("OTP"))&&(0,i.jsxs)("div",{className:"result-section",style:{backgroundColor:"#1f2937",borderRadius:"8px",padding:"15px",marginTop:"20px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[(0,i.jsx)(m.A,{size:16,style:{color:"#a78bfa"}}),(0,i.jsx)("span",{style:{fontSize:"13px",fontWeight:"600",color:"#d1d5db"},children:"Firma de Recibo"})]}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"#9ca3af",marginBottom:"12px"},children:"El equipo est\xe1 listo para ser entregado. Haz clic en el bot\xf3n de abajo para firmar el recibo de conformidad."}),(0,i.jsxs)("button",{onClick:()=>{var e;let t=(null==(e=M.numeroOrden)?void 0:e.split("-")[1])||"0";window.open("/firma?ordenId=".concat(t,"&modo=recibo"),"_blank")},style:{background:"linear-gradient(90deg, #8b5cf6 0%, #6d28d9 100%)",color:"white",border:"none",padding:"10px 20px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px",boxShadow:"0 2px 8px 0 rgba(139,92,246,0.25)",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="#6d28d9",onMouseLeave:e=>e.currentTarget.style.background="linear-gradient(90deg, #8b5cf6 0%, #6d28d9 100%)",children:[(0,i.jsx)(m.A,{size:14}),"Firmar Recibo de Entrega"]})]}),M.estado&&M.estado.toUpperCase().includes("CERRAD")&&(0,i.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:18},children:(0,i.jsxs)("button",{className:"btn-download-docs",style:{background:"linear-gradient(90deg, #8b5cf6 0%, #6d28d9 100%)",color:"white",border:"none",borderRadius:8,padding:"10px 22px",fontSize:15,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:10,boxShadow:"0 2px 8px 0 rgba(139,92,246,0.25)",transition:"background 0.2s"},title:"Descargar documentos de la OT",onClick:()=>window.open("/api/ordenes/".concat(M.numeroOrden,"/documentos"),"_blank"),onMouseEnter:e=>e.currentTarget.style.background="#6d28d9",onMouseLeave:e=>e.currentTarget.style.background="linear-gradient(90deg, #8b5cf6 0%, #6d28d9 100%)",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("path",{fill:"currentColor",d:"M12 16.5a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v10.5a1 1 0 0 1-1 1Z"}),(0,i.jsx)("path",{fill:"currentColor",d:"M7.21 13.79a1 1 0 0 1 1.42-1.42l2.29 2.3 2.29-2.3a1 1 0 1 1 1.42 1.42l-3 3a1 1 0 0 1-1.42 0l-3-3ZM5 20a1 1 0 0 1-1-1v-2a1 1 0 1 1 2 0v1h12v-1a1 1 0 1 1 2 0v2a1 1 0 0 1-1 1H5Z"})]}),"Descargar Documentos"]})})]}),I&&!M&&(0,i.jsxs)("div",{className:"result-card",children:[(0,i.jsxs)("div",{className:"result-header-row",children:[(0,i.jsx)("h3",{children:"Historial"}),(0,i.jsxs)("span",{style:{fontSize:13,opacity:.7},children:[I.length," ordenes encontradas"]})]}),0===I.length?(0,i.jsx)("div",{className:"result-empty",children:"No se encontraron \xf3rdenes asociadas."}):(0,i.jsx)("div",{className:"historial-scroll-container",children:(0,i.jsx)("div",{className:"historial-list",children:I.map(e=>{var t;return(0,i.jsxs)("div",{className:"result-item",onDoubleClick:()=>{W(e),window.scrollTo({top:0,behavior:"smooth"})},title:"Doble clic para ver detalles completos",children:[(0,i.jsxs)("div",{className:"result-item-left",children:[(0,i.jsx)("div",{className:"result-ord",style:{fontSize:16},children:e.numeroOrden}),(0,i.jsxs)("div",{className:"result-sub",style:{display:"flex",alignItems:"center",gap:6},children:[(0,i.jsx)(f.A,{size:12}),e.equipo?"".concat(e.equipo.marca," ").concat(e.equipo.modelo):null!=(t=e.tipoServicio)?t:"SERVICIO"]})]}),(0,i.jsxs)("div",{className:"result-item-right",style:{textAlign:"right"},children:[(0,i.jsx)("div",{className:"badge",style:{fontSize:11},children:e.estado}),(0,i.jsx)("div",{className:"result-date",children:function(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})}catch(t){return e}}(e.fechaHoraIngreso)}),e.estado&&e.estado.toUpperCase().includes("CERRAD")&&(0,i.jsxs)("button",{className:"btn-download-docs",style:{marginTop:6,background:"linear-gradient(90deg, #8b5cf6 0%, #6d28d9 100%)",color:"white",border:"none",borderRadius:8,padding:"8px 18px",fontSize:13,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:8,boxShadow:"0 2px 8px 0 rgba(139,92,246,0.25)",transition:"background 0.2s"},title:"Descargar documentos de la OT",onClick:t=>{t.stopPropagation(),window.open("/api/ordenes/".concat(e.numeroOrden,"/documentos"),"_blank")},onMouseEnter:e=>e.currentTarget.style.background="#6d28d9",onMouseLeave:e=>e.currentTarget.style.background="linear-gradient(90deg, #8b5cf6 0%, #6d28d9 100%)",children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("path",{fill:"currentColor",d:"M12 16.5a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v10.5a1 1 0 0 1-1 1Z"}),(0,i.jsx)("path",{fill:"currentColor",d:"M7.21 13.79a1 1 0 0 1 1.42-1.42l2.29 2.3 2.29-2.3a1 1 0 1 1 1.42 1.42l-3 3a1 1 0 0 1-1.42 0l-3-3ZM5 20a1 1 0 0 1-1-1v-2a1 1 0 1 1 2 0v1h12v-1a1 1 0 1 1 2 0v2a1 1 0 0 1-1 1H5Z"})]}),"Descargar Documentos"]})]})]},e.numeroOrden)})})})]})]})]}),E&&(0,i.jsx)(n,{cedula:l,onClose:()=>A(!1),onVerified:e=>{D(e),A(!1),F(e)},onVerify:Z})]})})}let b=e=>{let{label:t,value:s}=e;return(0,i.jsxs)("div",{className:"info-box",children:[(0,i.jsx)("span",{className:"info-label",children:t}),(0,i.jsx)("span",{className:"info-value",children:null!=s?s:"-"})]})};function y(e){if(!e)return"-";try{return new Date(e).toLocaleString("es-ES",{dateStyle:"medium",timeStyle:"short"})}catch(t){return e}}function N(e){return null==e?"0.00":e.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}}},e=>{e.O(0,[256,169,441,255,358],()=>e(e.s=8468)),_N_E=e.O()}]);